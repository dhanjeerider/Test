<style>/* style.css */

/* --- CSS Variables for Theming --- */
:root {
  --bg-primary: #111;
  --bg-secondary: #333;
  --bg-card: #222;
  --border: #333;
  --text-primary: #f1f1f1;
  --text-secondary: #aaa;
  --accent-purple: #7c3aed;
  --accent-cyan: #06b6d4;
  --star-yellow: #fbbf24;
  --font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

[data-theme="light"] {
  --bg-primary: #f1f1f1;
  --bg-secondary: #e0e0e0;
  --bg-card: #ffffff;
  --border: #d0d0d0;
  --text-primary: #0f0f0f;
  --text-secondary: #000;
}

/* --- Global Styles & Resets --- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  font-family: var(--font-family);
  overscroll-behavior: contain;
}

a {
  color: inherit;
  text-decoration: none;
}

h2, h3 {
  margin-bottom: 1rem;
  font-weight: 700;
  font-size:1.4rem;
}

/* --- Loading Spinner & Skeletons --- */
.loader {
  border: 4px solid var(--border);
  border-top: 4px solid var(--accent-purple);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  display: none;
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

.skeleton {
  background-color: var(--bg-card);
  position: relative;
  overflow: hidden;
}

.skeleton::after {
  content: '';
  position: absolute;
  top: 0;
  left: -150%;
  width: 150%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  100% { left: 150%; }
}

/* --- Layout --- */
.main-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background-color: var(--bg-primary);
  backdrop-filter: blur(10px);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  border-bottom: 1px solid var(--border);
  height: 60px;
}

main {
  padding-top: 60px;
  padding-bottom: 70px;
  min-height: 100vh;
}

.bottom-nav {
  display: flex;
  justify-content: space-around;
  align-items: center;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 70px;
  background-color: var(--bg-secondary);
  border-top: 1px solid var(--border);
  z-index: 100;
}

.page {
  display: none;
  opacity: 0;
  animation: fadeIn 0.4s ease-in-out forwards;
}

.page.active {
  display: block;
}

@keyframes fadeIn {
  to { opacity: 1; }
}

.content-section {
  padding: 0.8rem;
}

/* --- Header & Nav --- */
.header-left, .header-right { display: flex; align-items: center;justify-content:space-between; gap: 0.75rem; }
.logo { font-size: 1.25rem; color: var(--text-primary); font-weight: 700; }
.language-selector {width: 50%;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  color: var(--text-primary);
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
}
.language-selector:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: var(--accent-purple);
  transform: translateY(-2px);
}
.language-selector option {
  background: var(--bg-primary);
  color: var(--text-primary);
}
.menu-btn, .theme-btn, .profile-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.25rem; transition: all 0.3s ease; font-size: 24px; }
.menu-btn:hover, .theme-btn:hover, .profile-btn:hover { transform: scale(1.1); color: var(--accent-purple); }

/* --- Off-Canvas Menu --- */
.offcanvas-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  z-index: 199;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.offcanvas-overlay.active {
  opacity: 1;
  visibility: visible;
}

.offcanvas-menu {
  position: fixed;
  top: 0;
  left: -320px;
  width: 320px;
  height: 100vh;
  background-color: var(--bg-secondary);
  z-index: 200;
  transition: left 0.3s ease;
  overflow-y: auto;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
}

.offcanvas-menu.active {
  left: 0;
}

.offcanvas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
}

.offcanvas-header h2 {
  font-size: 1.3rem;
  color: white;
  margin: 0;
}

.offcanvas-close {
  background: none;
  border: none;
  color: white;
  font-size: 32px;
  cursor: pointer;
  padding: 0;
  transition: transform 0.2s ease;
}

.offcanvas-close:hover {
  transform: rotate(90deg);
}

.offcanvas-body {
  padding: 1rem;
}

.offcanvas-section {
  margin-bottom: 1.5rem;
}

.offcanvas-section h3 {
  font-size: 1.1rem;
  margin-bottom: 0.8rem;
  color: var(--text-primary);
  border-bottom: 2px solid var(--accent-purple);
  padding-bottom: 0.5rem;
}

.genres-list {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

.genre-link {
  padding: 0.6rem 0.8rem;
  background-color: var(--bg-card);
  border-radius: 6px;
  color: var(--text-primary);
  text-decoration: none;
  transition: all 0.2s ease;
  border-left: 3px solid transparent;
}

.genre-link:hover {
  background: linear-gradient(90deg, rgba(124, 58, 237, 0.2), rgba(124, 58, 237, 0.1));
  border-left-color: var(--accent-purple);
  transform: translateX(5px);
}

/* --- Language Selection Modal --- */
.language-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(10px);
  z-index: 300;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.language-modal.active {
  display: flex;
}

.language-modal-content {
  background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
  border-radius: 16px;
  max-width: 500px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
  border: 1px solid var(--border);
}

.language-modal-header {
  padding: 1.5rem;
  text-align: center;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
}

.language-modal-header h2 {
  font-size: 1.5rem;
  color: white;
  margin-bottom: 0.5rem;
}

.language-modal-header p {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.9);
  margin: 0;
}

.language-modal-body {
  padding: 1.5rem;
}

.language-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.8rem;
}

.language-option {
  padding: 1rem;
  background-color: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: 10px;
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.language-option:hover {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(219, 39, 119, 0.3));
  border-color: var(--accent-purple);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
}

.nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-secondary); flex-grow: 1; padding: 0.5rem 0; text-decoration: none; }
.nav-item i { font-size: 24px; margin-bottom: 4px; transition: transform 0.2s ease; }
.nav-item span { font-size: 0.75rem; }
.nav-item.active { color: var(--accent-purple); font-weight: 600; }
.nav-item.active i { transform: scale(1.1); }

@keyframes pop {
  from { background-size: 100%; }
  to { background-size: 140%; filter: saturate(2); }
}

/* --- Buttons & Inputs --- */
.btn {
  padding: 0.75rem 1.5rem;
  border: 2px solid rgba(255, 255, 255, 0.2);
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(219, 39, 119, 0.9));
  backdrop-filter: blur(15px);
  box-shadow: 0 8px 32px rgba(124, 58, 237, 0.4);
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  color: #ffffff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.btn::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
  transform: scale(0);
  transition: transform 0.5s ease;
}

.btn:hover::before {
  transform: scale(1);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(124, 58, 237, 0.6);
  border-color: rgba(255, 255, 255, 0.4);
}

.btn-primary { 
  background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%); 
  color: white;
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
}
.btn-primary:hover { 
  background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
  transform: translateY(-3px);
  box-shadow: 0 12px 32px rgba(124, 58, 237, 0.6);
}

.btn-outline { 
  background: rgba(255, 255, 255, 0.05); 
  border: 2px solid rgba(255, 255, 255, 0.2);
  color: var(--text-primary);
  backdrop-filter: blur(10px);
}
.btn-outline.active, .btn-outline:hover { 
  background: linear-gradient(135deg, rgba(220, 38, 38, 0.8), rgba(239, 68, 68, 0.8));
  border-color: rgba(239, 68, 68, 0.5);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(220, 38, 38, 0.4);
}
.clear-btn { background-color: var(--accent-cyan); color: white; padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }

.show-more-btn {
  margin-top: 1rem;
  width: 100%;
}

/* --- Content Cards --- */
.grid-container {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  padding: 15px;
}

/* Platform cards in grid-container */
.grid-container .platform-card {
  min-height: 140px;
}

.horizontal-scroll-container {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: 150px;
  overflow-x: auto;
  gap: 1rem;
  padding-bottom: 1rem;
  scroll-snap-type: x mandatory;
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.horizontal-scroll-container::-webkit-scrollbar { display: none; }

.content-card {
  background-color: var(--bg-card);
  border-radius: 8px;
  overflow: hidden;
  min-width: 150px;
  border: 1px solid var(--border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  padding:0;
  scroll-snap-align: start;
  position: relative;
  display: flex;
  flex-direction: column;
}

.content-card:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  z-index: 5;
}

.card-poster { width: 100%; aspect-ratio: 2/3; object-fit: cover; background-color: var(--bg-secondary); }
.card-info { padding: 0.75rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
.card-title { font-size: 0.875rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 0.5rem; }
.card-meta { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: var(--text-secondary); }
.card-rating { color: var(--star-yellow); font-weight: 600; }
.card-type { background-color: var(--accent-purple); padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; color: white; }

/* --- Home Page: Hero Carousel --- */
.hero-carousel-container {
  position: relative;
  width: 100%;
  aspect-ratio: 16/9;
  margin-bottom: 1rem;
  overflow: hidden;
  background-color: var(--bg-secondary);
  border-radius: 12px;
}

.hero-slide {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  opacity: 0;
  transform: scale(1.1);
  transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
  visibility: hidden;
}

.hero-slide.active { 
  opacity: 1; 
  visibility: visible; 
  transform: scale(1);
  animation: slideZoom 0.8s ease-out;
}

@keyframes slideZoom {
  0% {
    transform: scale(1.1);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.hero-backdrop { 
  width: 100%; 
  height: 100%; 
  object-fit: cover;
  animation: kenBurns 20s ease-in-out infinite alternate;
}

@keyframes kenBurns {
  0% {
    transform: scale(1);
  }
  100% {
    transform: scale(1.1);
  }
}

.hero-overlay {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
  display: flex;
  align-items: flex-end;
  padding: 1.5rem;
}

.hero-content { 
  display: flex; 
  align-items: flex-end; 
  gap: 1rem; 
  width: 100%;
  animation: slideUp 0.6s ease-out 0.2s both;
}

@keyframes slideUp {
  0% {
    transform: translateY(30px);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

.hero-poster { 
  width: 80px; 
  aspect-ratio: 2/3; 
  object-fit: cover; 
  border-radius: 8px; 
  flex-shrink: 0; 
  box-shadow: 0 8px 24px rgba(0,0,0,0.6);
  transition: transform 0.3s ease;
}

.hero-poster:hover {
  transform: scale(1.05);
}

.hero-details { flex-grow: 1; }
.hero-logo { 
  max-width: 150px; 
  max-height: 60px; 
  object-fit: contain; 
  margin-bottom: 0.5rem;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.8));
}
.hero-title-text { 
  font-size: 1rem; 
  font-weight: 700; 
  color: #fff;
  text-shadow: 0 2px 8px rgba(0,0,0,0.8);
}
.hero-meta { 
  color: var(--text-secondary); 
  display: flex; 
  gap: 1rem; 
  align-items: center; 
  margin: 0.5rem 0 1rem 0; 
  font-size: 0.875rem;
  text-shadow: 0 1px 4px rgba(0,0,0,0.8);
}
.hero-rating { color: var(--star-yellow); }

/* --- Discover & Genre Pages --- */
.discover-header { padding: 1rem; padding-bottom: 0; }
.filter-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin: 1rem 0; }
.filter-bar select {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border);
  padding: 0.75rem 0.5rem;
  border-radius: 6px;
  font-size: 0.875rem;
  width: 100%;
}

.tab-switcher { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
.tab-btn {
  background: var(--bg-card);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  padding: 0.75rem 1rem;
  font-size: 1rem;
  cursor: pointer;
  border-radius: 8px;
  flex-grow: 1;
}

.tab-btn.active { color: var(--text-primary); border-color: var(--accent-purple); background-color: var(--accent-purple); }

/* --- Preview Page --- */
#preview { padding: 0; }
.preview-banner { position: relative; padding-top: 56.25%; background-color: var(--bg-secondary); }
.preview-backdrop { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
.preview-banner-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, #111 2%, transparent 100%); }
.preview-header { position: absolute; bottom: -50px; left: 1rem; right: 2rem; display: flex; align-items: flex-end; gap: 1rem; }
.preview-poster { width: 120px; aspect-ratio: 2/3; object-fit: cover; border-radius: 8px; border: 2px solid var(--border); box-shadow: 0 5px 20px rgba(0,0,0,0.6); }
.preview-title-section { flex-grow: 1; margin-bottom: 0.5rem; }
.preview-logo { width: 100%; max-width: 320px; max-height: 100px; object-fit: contain; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.8)); }
.preview-title-text { font-size: 2rem; font-weight: 700; text-shadow: 0 2px 5px rgba(0,0,0,0.8); }
.preview-tagline { font-style: italic; color: var(--text-secondary); font-size: 0.875rem; }
.preview-content { padding: 80px 1rem 1rem 1rem; }
.preview-actions { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
.preview-details-panel { 
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 1.25rem; 
  border-radius: 12px; 
  margin-bottom: 2rem; 
  display: flex; 
  align-items: flex-start; 
  gap: 1.5rem; 
  flex-wrap: wrap;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}
.detail-item { 
  display: flex; 
  align-items: center; 
  gap: 0.5rem; 
  color: var(--text-primary);
  font-weight: 500;
  padding: 0.5rem 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  transition: all 0.2s ease;
}
.detail-item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}
.detail-item svg {
  flex-shrink: 0;
}
.genre-chips { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; width: 100%; }
.genre-chip { 
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(219, 39, 119, 0.2));
  border: 1px solid rgba(124, 58, 237, 0.3);
  padding: 0.4rem 1rem; 
  border-radius: 20px; 
  font-size: 0.8rem; 
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  text-decoration: none;
  color: var(--text-primary);
}
.genre-chip:hover {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.4), rgba(219, 39, 119, 0.4));
  border-color: rgba(124, 58, 237, 0.6);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}
.preview-overview { line-height: 1.6; margin-bottom: 2rem; color: var(--text-secondary); }
.trailer-container, .cast-container, .similar-container { margin-bottom: 2rem; }
.trailer-embed { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000; border-radius: 8px; }
.trailer-embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
.actor-card { text-align: center; width: 100px; cursor: pointer; }
.actor-image { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin: 0 auto 0.5rem auto; background-color: var(--bg-secondary); }
.actor-name { font-size: 0.875rem; font-weight: 600; }
.actor-character { font-size: 0.75rem; color: var(--text-secondary); }

/* --- Actor Page --- */
.actor-profile-container { padding: 1rem; }
.actor-banner {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
  padding: 2rem 1rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  text-align: center;
}
.actor-profile-image {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid white;
  margin: 0 auto 1rem;
  display: block;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}
.actor-profile-name {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: white;
}
.actor-profile-info {
  color: rgba(255,255,255,0.9);
  font-size: 0.9rem;
}
.actor-bio {
  background-color: var(--bg-card);
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 2rem;
  line-height: 1.6;
}
.actor-known-for h3, .actor-credits h3 {
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

/* --- Player Page --- */
#play { padding: 1rem; background-color: var(--bg-primary); }
.player-container { max-width: 1200px; margin: auto; background-color: var(--bg-primary); }
.player-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
.server-controls { justify-content: space-between; width: 100%; display: flex; gap: 1rem; padding: 15px 5px; align-items: center; }
.ad-blocker-toggle { white-space: nowrap; }
.server-selector { display: flex; flex-wrap: wrap; gap: 0.5rem; }
.server-btn { background-color: var(--bg-secondary); color: var(--text-secondary); border: 1px solid var(--border); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; }
.server-btn.active { background-color: var(--accent-purple); color: white; border-color: var(--accent-purple); }
.server-dropdown {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border);
  padding: 0.5rem;
  border-radius: 6px;
  width: 50%;
}
.ad-blocker-toggle { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; cursor: pointer; user-select: none; }
.video-embed-wrapper { position: relative; aspect-ratio: 16/9; background-color: var(--bg-primary); border-radius: 8px; overflow: hidden; }
.video-embed-wrapper iframe { width: 100%; height: 100%; border: none; }

/* --- Download Servers --- */
.download-servers {
  background-color: var(--bg-card);
  padding: 1.2rem 1rem;
  border-radius: 8px;
  margin: 1.5rem 0;
  display: block; 
  text-align: center;
}
.download-servers h3 {
  margin-bottom: 0.8rem;
  color: var(--text-primary);
}
.download-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 1.5rem;
}
.download-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--bg-secondary);
  padding: 1rem;
  border-radius: 6px;
  border: 1px solid var(--border);
}
.download-info {
  flex: 1;
}
.download-name {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.25rem;
}
.download-desc {
  font-size: 0.85rem;
  color: var(--text-secondary);
}

.download-buttons-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 0.8rem;
  min-height: 50px;
  justify-content: center;
}

.download-btn {
  color: white;
  padding: 0.7rem 1rem;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  font-weight: 600;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
  text-align: center;
  min-width: 140px;
  flex: 0 1 auto;
}

.download-btn:nth-child(1) {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.download-btn:nth-child(1):hover {
  background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
}

.download-btn:nth-child(2) {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.download-btn:nth-child(2):hover {
  background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
}

.download-btn:nth-child(3) {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.download-btn:nth-child(3):hover {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);
}

.download-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.5s ease;
}

.download-btn:hover::before {
  left: 100%;
}

.download-btn:hover {
  transform: translateY(-2px);
  border-color: rgba(255, 255, 255, 0.4);
}

.download-btn-icon {
  font-size: 1.2rem;
}

.download-btn-text {
  font-size: 0.85rem;
  font-weight: 600;
}

/* --- TV Season Details --- */
.tv-season-details { 
  margin-top: 1.5rem; 
  background-color: var(--bg-card);
  padding: 1rem;
  border-radius: 12px;
  display: block;
}
.tv-season-details .section-header {
  margin-bottom: 1rem;
}
.season-item { 
  margin-bottom: 0.75rem; 
}
.season-header { 
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(219, 39, 119, 0.3));
  backdrop-filter: blur(10px);
  border: 1px solid rgba(124, 58, 237, 0.4);
  padding: 0.9rem 1.2rem; 
  border-radius: 12px; 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  font-size: 1rem;
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
}
.season-header:hover {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.5), rgba(219, 39, 119, 0.5));
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
  border-color: rgba(124, 58, 237, 0.6);
}
.season-header.active {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
  border-color: transparent;
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.5);
}
.season-header span:last-child { 
  transition: transform 0.3s ease;
  font-size: 1.2rem;
}
.season-header.active span:last-child { 
  transform: rotate(180deg); 
}
.episodes-grid { 
  display: none; 
  grid-template-columns: 1fr; 
  gap: 0.4rem; 
  
  margin-top: 0.6rem;
  border: 1px solid rgba(124, 58, 237, 0.2);
}

@media (max-width: 640px) {
  .episodes-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .episode-item {
    flex-direction: column;
    text-align: center;
  }
  
  .episode-thumbnail {
    width: 100%;
  }
}
.episode-item { 
  display: flex; 
  gap: 0.8rem; 
  align-items: center; 
  padding: 0.2rem; 
  border-radius: 10px; 
  cursor: pointer; 
  transition: all 0.3s ease;
  text-decoration: none;
  color: var(--text-primary);
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.episode-item.active { 
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
  border-color: transparent;
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
  transform: scale(1.008);

}
.episode-item:hover { 
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(219, 39, 119, 0.3));
  border-color: rgba(124, 58, 237, 0.5);
  transform: translateX(8px);
  box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
}
.episode-thumbnail { 
  width: 150px; 
  min-width: 150px;
  aspect-ratio: 16/9; 
  object-fit: cover; 
  border-radius: 8px; 
  background-color: var(--bg-primary);
  border: 2px solid rgba(124, 58, 237, 0.3);
  transition: all 0.3s ease;
}
.episode-item:hover .episode-thumbnail {
  border-color: rgba(124, 58, 237, 0.7);
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
}
.episode-info { flex: 1; }
.episode-info h4 { 
  font-size: .8rem; 
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--text-primary);
}
.episode-info p { 
  font-size: 0.65rem; 
  color: var(--text-secondary); 
  line-height: 1.5;
}

/* --- Popular Movies Section in Player --- */
.popular-movies-section {
  margin-top: 3rem;
  padding: 1rem 0;
}
.section-header {
  margin-bottom: 1rem;
}
.section-header h2 {
  font-size: 1.5rem;
  color: var(--text-primary);
}

/* --- Profile Page --- */
.profile-header { text-align: center; padding: 2rem 1rem; }
.profile-avatar-wrapper { position: relative; width: 120px; height: 120px; margin: 0 auto 1rem auto; cursor: pointer; }
.profile-avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-purple); }
#profile-name { font-size: 1.5rem; margin-bottom: 0.5rem; }
#profile-name[contenteditable="true"] { border: 1px dashed var(--border); padding: 0.25rem; outline-color: var(--accent-purple); }
.edit-profile-btn { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); cursor: pointer; font-size: 0.875rem; padding: 0.5rem 1rem; border-radius: 8px; }
.profile-content { padding: 1rem; }
.profile-tab-content { display: none; margin-top: 1rem; }
.profile-tab-content.active { display: block; }
.content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
#watch-history-list .history-item { display: flex; gap: 1rem; align-items: center; background-color: var(--bg-card); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; }
.history-poster { width: 60px; aspect-ratio: 2/3; object-fit: cover; border-radius: 4px; }
.history-info { flex-grow: 1; }
.history-info h4 { font-size: 1rem; }
.history-info p { font-size: 0.75rem; color: var(--text-secondary); }
.history-view-btn { background-color: var(--bg-secondary); border: 1px solid var(--border); padding: 0.5rem 1rem; border-radius: 6px; }

/* --- Search Page --- */
#search { padding: 1rem; }
.search-bar-container { position: relative; margin-bottom: 2rem; }
#search-input { width: 100%; padding: 1rem; padding-right: 3rem; font-size: 1rem; background-color: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); }
#clear-search-btn { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; display: none; }

/* --- Responsive Media Queries --- */
@media (max-width: 640px) {
  .btn {
    padding: 0.6rem 1rem;
    font-size: 0.85rem;
  }
  
  .btn-primary {
    padding: 0.55rem 1rem;
    font-size: 0.8rem;
  }
  
  .btn-outline {
    padding: 0.5rem 0.9rem;
    font-size: 0.8rem;
  }
  
  .action-btn {
    padding: 0.7rem 1rem;
    font-size: 0.85rem;
  }
  
  .download-btn {
    padding: 0.6rem 1.2rem;
    font-size: 0.85rem;
  }
}

@media (min-width: 640px) {
  .grid-container { grid-template-columns: repeat(3, 1fr); }
  .filter-bar { grid-template-columns: repeat(4, 1fr); }
  .preview-header { bottom: -60px; }
  .preview-poster { width: 26%; }
  .preview-content { padding-top: 100px; }
}

@media (min-width: 1024px) {
  main { max-width: 1280px; margin: auto; }
  .grid-container { grid-template-columns: repeat(6, 1fr); }
  .preview-header { bottom: -80px; }
  .preview-poster { width: 220px; }
  .preview-content { padding-top: 120px; gap: 2rem; }
  .hero-title-text { font-size: 3rem; }
  .hero-details .btn-primary, .hero-details .hero-meta { font-size: 1.8rem; }
}

/* --- Circular Rating Display --- */
.card-rating-circle {
  position: absolute;
  top: 8px;
  left: 8px;
  width: 32px;
  height: 32px;
  z-index: 2;
}

.card-rating-circle svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

.card-rating-circle .rating-bg {
  fill: none;
  stroke: rgba(0, 0, 0, 0.6);
  stroke-width: 3;
}

.card-rating-circle .rating-val {
  fill: none;
  stroke: #21d07a;
  stroke-width: 3;
  stroke-dasharray: 100;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.3s ease;
}

.card-rating-circle .rating-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.65rem;
  font-weight: 700;
  color: white;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

/* --- Platforms Grid --- */
.platform-main-title {
  padding: 1rem;
  font-size: 1.8rem;
  font-weight: 700;
}

.platform-providers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 1.5rem;
  padding: 1rem;
}

.platform-providers-search {
  padding: 0 1rem 1rem 1rem;
}

#platform-providers-search-input {
  width: 100%;
  padding: 0.7rem 1rem;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

#platform-providers-search-input:focus {
  outline: none;
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

#platform-providers-search-input::placeholder {
  color: var(--text-secondary);
}

.platform-provider-card {
  background-color: var(--bg-card);
  border-radius: 12px;
  padding: 1.5rem 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.8rem;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  min-height: 160px;
  border: 1px solid var(--border);
}

.platform-provider-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
  border-color: var(--accent-purple);
}

.platform-provider-card img {
  width: 80px;
  height: 80px;
  object-fit: contain;
  border-radius: 8px;
}

.platform-provider-name {
  font-size: 0.85rem;
  font-weight: 600;
  text-align: center;
  color: var(--text-primary);
}

.platform-content-view .discover-header {
  padding: 1rem;
}

.platform-search-box {
  margin: 0.8rem 0;
}

#platform-search-input {
  width: 100%;
  padding: 0.7rem 1rem;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

#platform-search-input:focus {
  outline: none;
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

#platform-search-input::placeholder {
  color: var(--text-secondary);
}

.platforms-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
  width: 100%;
}

.platform-card {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
  border-radius: 12px;
  padding: 2rem 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  min-height: 140px;
}

.platform-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(124, 58, 237, 0.4);
}

.platform-logo {
  font-size: 3rem;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.platform-name {
  font-size: 0.9rem;
  font-weight: 600;
  text-align: center;
  color: white;
  margin: 0;
}

@media (max-width: 480px) {
  .platform-providers-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .platform-provider-card {
    min-height: 140px;
    padding: 1rem 0.5rem;
  }
  
  .platform-provider-card img {
    width: 60px;
    height: 60px;
  }
  
  .platforms-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .platform-card {
    min-height: 120px;
    padding: 1.5rem 0.5rem;
  }
  
  .platform-logo {
    font-size: 2.5rem;
  }
  
  .platform-name {
    font-size: 0.8rem;
  }
}

@media (min-width: 640px) {
  .platform-providers-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .platforms-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (min-width: 1024px) {
  .platform-providers-grid {
    grid-template-columns: repeat(6, 1fr);
  }
  
  .platforms-grid {
    grid-template-columns: repeat(6, 1fr);
  }
}
    
</style>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vega Movies</title>
<!-- Boxicons CSS -->
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<!-- Preconnect to Google Fonts for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<!-- Import the Inter font family -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Main Header: Stays fixed at the top -->
<header class="main-header">
<div class="header-left">
<button class="menu-btn" aria-label="Open menu">
<i class='bx bx-wiggle bx-menu' ></i>
</button>
<a href="#home"><h1 class="logo">Aura</h1></a>
</div>
<div class="header-right">
<select id="language-selector" class="language-selector" aria-label="Select language">
<option value="">üåê Language</option>
<option value="en">üá∫üá∏ English</option>
<option value="hi">üáÆüá≥ Hindi</option>
<option value="ta">üáÆüá≥ Tamil</option>
<option value="te">üáÆüá≥ Telugu</option>
<option value="kn">üáÆüá≥ Kannada</option>
<option value="es">üá™üá∏ Spanish</option>
<option value="fr">üá´üá∑ French</option>
<option value="de">üá©üá™ German</option>
<option value="ja">üáØüáµ Japanese</option>
<option value="ko">üá∞üá∑ Korean</option>
<option value="zh">üá®üá≥ Chinese</option>
<option value="pt">üáµüáπ Portuguese</option>
<option value="ru">üá∑üá∫ Russian</option>
</select>
<button class="theme-btn" aria-label="Toggle theme">
<i class='bx bx-wiggle bx-moon'></i>
</button>
<a href="#profile" class="profile-btn" aria-label="View profile">
<i class='bx bx-wiggle bx-user-circle'></i>
</a>
</div>
</header>

<!-- Language Selection Modal -->
<div class="language-modal" id="language-modal">
<div class="language-modal-content">
<div class="language-modal-header">
<h2>üåê Select Your Language</h2>
<p>Choose your preferred language to get started</p>
</div>
<div class="language-modal-body">
<div class="language-options">
<button class="language-option" data-lang="en" data-flag="üá∫üá∏" data-name="English">üá∫üá∏ English</button>
<button class="language-option" data-lang="hi" data-flag="üáÆüá≥" data-name="Hindi">üáÆüá≥ Hindi</button>
<button class="language-option" data-lang="ta" data-flag="üáÆüá≥" data-name="Tamil">üáÆüá≥ Tamil</button>
<button class="language-option" data-lang="te" data-flag="üáÆüá≥" data-name="Telugu">üáÆüá≥ Telugu</button>
<button class="language-option" data-lang="kn" data-flag="üáÆüá≥" data-name="Kannada">üáÆüá≥ Kannada</button>
<button class="language-option" data-lang="es" data-flag="üá™üá∏" data-name="Spanish">üá™üá∏ Spanish</button>
<button class="language-option" data-lang="fr" data-flag="üá´üá∑" data-name="French">üá´üá∑ French</button>
<button class="language-option" data-lang="de" data-flag="üá©üá™" data-name="German">üá©üá™ German</button>
<button class="language-option" data-lang="ja" data-flag="üáØüáµ" data-name="Japanese">üáØüáµ Japanese</button>
<button class="language-option" data-lang="ko" data-flag="üá∞üá∑" data-name="Korean">üá∞üá∑ Korean</button>
<button class="language-option" data-lang="zh" data-flag="üá®üá≥" data-name="Chinese">üá®üá≥ Chinese</button>
<button class="language-option" data-lang="pt" data-flag="üáµüáπ" data-name="Portuguese">üáµüáπ Portuguese</button>
</div>
</div>
</div>
</div>

<!-- Off-Canvas Menu -->
<div class="offcanvas-overlay"></div>
<div class="offcanvas-menu" id="offcanvas-menu">
<div class="offcanvas-header">
<h2>Browse Genres</h2>
<button class="offcanvas-close" aria-label="Close menu">
<i class='bx bx-wiggle bx-x'></i>
</button>
</div>
<div class="offcanvas-body">
<div class="offcanvas-section">
<h3>üé¨ Movie Genres</h3>
<div class="genres-list" id="movie-genres-list">
<div class="loader" style="display:block; position:relative; margin: 2rem auto;"></div>
</div>
</div>
<div class="offcanvas-section">
<h3>üì∫ TV Genres</h3>
<div class="genres-list" id="tv-genres-list">
<div class="loader" style="display:block; position:relative; margin: 2rem auto;"></div>
</div>
</div>
</div>
</div>

<!-- Main Content Area: Hosts all the page sections -->
<main>

<!-- Home Page Section -->
<section id="home" class="page">
<div class="hero-carousel-container skeleton"></div>
 


<style>
  

  .boxy{
    max-width:420px;
    width:100%;
    padding:20px;
    text-align:center;
    background:#020617;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.4);
  }

  h1{
    font-size:22px;
    margin-bottom:10px;
  }

  p{
    font-size:14px;
    color:#cbd5f5;
    margin-bottom:18px;
  }

  .btns{
    display:flex;
    gap:12px;
    justify-content:center;
    flex-wrap:wrap;
  }

  button,a{
    padding:12px 18px;
    border-radius:10px;
    border:none;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
    color:#fff;
  }

  .tg{
    background:linear-gradient(135deg,#229ED9,#0a66c2);
  }

  .app{
    background:linear-gradient(135deg,#22c55e,#16a34a);
  }
</style>


<div class="boxy">
  <h3>DK TechnoZone</h3>
  <p>Movies, tools aur updates ke liye Telegram join karo aur is website ka  app install karo.</p>

  <div class="btns">
    <a class="tg" href="https://t.me/dktechnozone" target="_blank">
      üì¢ Join Telegram
    </a>
    
  </div>
</div>

<a href="#search"> <div class="search-bar-container">
<input type="text" id="search-input" placeholder="Search movies, TV shows &amp; more..." autocomplete="off">
<button id="clear-search-btn" aria-label="Clear search text">√ó</button>
</div></a>

<div class="content-section">
<h2>üé¨ Popular Movies</h2>
<div class="horizontal-scroll-container" id="popular-movies"></div>
</div>
<div class="content-section">
<h2>üì∫ Popular TV Shows</h2>
<div class="horizontal-scroll-container" id="popular-tv"></div>
</div>
<div class="content-section">
<h2>üí• Action Movies</h2>
<div class="horizontal-scroll-container" id="action-movies"></div>
</div>
<div class="content-section">
<h2>üî™ Crime & Thriller</h2>
<div class="horizontal-scroll-container" id="crime-movies"></div>
</div>
<div class="content-section">
<h2>üòÇ Comedy</h2>
<div class="horizontal-scroll-container" id="comedy-movies"></div>
</div>
<div class="content-section">
<h2>üëª Horror</h2>
<div class="horizontal-scroll-container" id="horror-movies"></div>
</div>
</section>

<!-- Discover Movies Page Section -->
<section id="movies" class="page">
<div class="discover-header">
<h2>Discover Movies</h2>
<div class="filter-bar" id="movies-filter-bar"></div>
</div>
<div class="grid-container" id="movies-grid"></div>
<div class="sentinel"></div>
</section>

<!-- Discover TV Shows Page Section -->
<section id="tv" class="page">
<div class="discover-header">
<h2>Discover TV Shows</h2>
<div class="filter-bar" id="tv-filter-bar"></div>
</div>
<div class="grid-container" id="tv-grid"></div>
<div class="sentinel"></div>
</section>

<!-- Single Genre Page Section -->
<section id="genre" class="page">
<div class="discover-header">
<h2 id="genre-title">Genre</h2>
<div class="tab-switcher" id="genre-tab-switcher">
<button class="tab-btn active" data-type="movie">Movies</button>
<button class="tab-btn" data-type="tv">TV Shows</button>
</div>
<div class="filter-bar" id="genre-filter-bar"></div>
</div>
<div class="grid-container" id="genre-grid"></div>
<div class="sentinel"></div>
</section>

<!-- Platform Page Section -->
<section id="platform" class="page">
<div class="platform-providers-view">
<h2 class="platform-main-title">üé≠ Streaming Platforms</h2>
<div class="platform-providers-search">
<input type="text" id="platform-providers-search-input" placeholder="üîç Search platforms..." />
</div>
<div class="platform-providers-grid" id="platform-providers-grid"></div>
<div class="platform-providers-loader" style="display:none; text-align:center; padding: 1rem;">Loading more...</div>
</div>
<div class="platform-content-view" style="display:none;">
<div class="discover-header">
<h2 id="platform-title">Platform Content</h2>
<div class="platform-search-box">
<input type="text" id="platform-search-input" placeholder="üîç Search in platform..." />
</div>
<div class="tab-switcher" id="platform-tab-switcher">
<button class="tab-btn active" data-type="movie">Movies</button>
<button class="tab-btn" data-type="tv">TV Shows</button>
</div>
</div>
<div class="grid-container" id="platform-grid"></div>
<div class="platform-loader" style="display:none; text-align:center; padding: 1rem;">Loading...</div>
<div class="sentinel"></div>
</div>
</section>

<!-- Actor/Person Page Section -->
<section id="actor" class="page">
<div class="actor-profile-container">
<!-- Actor details will be dynamically injected here -->
</div>
</section>

<!-- Preview Page Section -->
<section id="preview" class="page"></section>

<!-- Player Page Section -->
<section id="play" class="page">
  <div class="player-container">
    <!-- Video Player -->
    <div class="video-embed-wrapper">
      <div class="loader"></div>
      <iframe id="video-player-iframe" allowfullscreen allow="autoplay; encrypted-media"></iframe>
    </div>

    <!-- Server Controls Below Frame -->
    <div class="player-controls">
      <div class="server-controls">
        <label class="ad-blocker-toggle">
          <input type="checkbox" id="sandbox-toggle" checked> üõ° Ad Blocker
        </label>
        <div class="server-selector-container">
          <label>Server:</label>
          <select id="server-dropdown" class="server-dropdown">
            <option value="">Select Server</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Download Servers Section -->
    <div class="download-servers">
      <h3>Download Options</h3>
      <div class="download-buttons-grid" id="download-buttons-grid"></div>
    </div>

    <!-- TV Season Details -->
    <div class="tv-season-details"></div>

    <!-- Popular Movies Section -->
    <div class="popular-movies-section">
      <div class="section-header">
        <h2>Popular Movies</h2>
      </div>
      <div class="grid-container" id="popular-movies-grid"></div>
      <div id="popular-movies-sentinel" class="sentinel"></div>
    </div>
  </div>
</section>

<!-- Profile Page Section -->
<section id="profile" class="page">
<div class="profile-header">
<div class="profile-avatar-wrapper" title="Click to change avatar">
<img src="https://placehold.co/150x150/7c3aed/FFFFFF?text=G" alt="User Avatar" class="profile-avatar" id="profile-avatar-img">
<input type="file" id="avatar-upload" accept="image/*" hidden>
</div>
<h2 id="profile-name" contenteditable="false">Guest User</h2>
<button class="edit-profile-btn" id="edit-profile-btn">‚úèÔ∏è Edit Profile</button>
</div>
<div class="profile-content">
<div class="tab-switcher" id="profile-tab-switcher">
<button class="tab-btn active" data-content="history">Watch History</button>
<button class="tab-btn" data-content="liked">Liked Content</button>
</div>
<div class="profile-tab-content active" id="history-content">
<div class="content-header">
<h3>Your Watch History</h3>
<button class="clear-btn" id="clear-history-btn">Clear</button>
</div>
<div id="watch-history-list"></div>
</div>
<div class="profile-tab-content" id="liked-content">
<h3>Your Liked Content</h3>
<div class="grid-container" id="liked-grid"></div>
</div>
</div>
</section>

<!-- Search Page Section -->
<section id="search" class="page">
<div class="search-bar-container">
<input type="text" id="search-input" placeholder="Search movies, TV shows & more..." autocomplete="off">
<button id="clear-search-btn" aria-label="Clear search text">&times;</button>
</div>
<div class="grid-container" id="search-results-grid"></div>
<div class="sentinel"></div>
</section>

</main>

<!-- Bottom Navigation Bar: Stays fixed at the bottom -->
<nav class="bottom-nav">
<a href="#home" class="nav-item active" data-route="home">
<i class='bx bx-wiggle bx-home'></i>
<span>Home</span>
</a>
<a href="#movies" class="nav-item" data-route="movie">
<i class='bx bx-wiggle bx-movie'></i>
<span>Movies</span>
</a>
<a href="#tv" class="nav-item" data-route="tv">
<i class='bx bx-wiggle bx-tv'></i>
<span>TV</span>
</a>
<a href="#platform" class="nav-item" data-route="platform">
<i class='bx bx-wiggle bx-grid-alt'></i>
<span>Platforms</span>
</a>
<a href="#search" class="nav-item" data-route="search">
<i class='bx bx-wiggle bx-search'></i>
<span>Search</span>
</a>
</nav>

<script>
const BASE_URL = 'https://tmdbdk.dktczn.workers.dev/tmdb';
const API_KEY = '7bffed716d50c95ed1c4790cfab4866a';const servers = [
  {
    name: "change server if not playing",
    type: "imdb",
    url: "https://seyki394bis.com/play/{imdb_id}",
    url_tv: "https://seyki394bis.com/play/{imdb_id}",
  },
   {
    name: 'Vidify',
    type: 'tmdb',
    url: 'https://vidify.top/embed/movie/{tmdb_id}',
    url_tv: 'https://vidify.top/embed/tv/{tmdb_id}/{season}/{episode}',
  },
  {
    name: 'Change Server If Not Playing',
    type: 'tmdb',
    url: 'https://autoembed.co/movie/tmdb/{tmdb_id}',
    url_tv: 'https://autoembed.co/tv/tmdb/{tmdb_id}-{season}-{episode}',
  },
  {
    name: 'vid vip',
    type: 'imdb',
    url: 'https://vidrock.net/movie/{imdb_id}',
    url_tv: 'https://vidrock.net/tv/{imdb_id}/{season}/{episode}',
  },
  {
    name: 'MoviesAPI',
    type: 'tmdb',
    url: 'https://moviesapi.club/movie/{tmdb_id}',
    url_tv: 'https://moviesapi.club/tv/{tmdb_id}-{season}-{episode}',
  },
  {
    name: "VidLink",
    type: "tmdb",
    url: "https://vidlink.pro/movie/{tmdb_id}",
    url_tv: "https://vidlink.pro/tv/{tmdb_id}/{season}/{episode}",
  },
  {
    name: "VidSrcXyz",
    type: "tmdb",
    url: "https://vidsrc.xyz/embed/movie/{tmdb_id}",
    url_tv: "https://vidsrc.xyz/embed/tv/{tmdb_id}/{season}/{episode}",
  },
  
  {
    name: "SmashyStream",
    type: "tmdb",
    url: "https://player.smashy.stream/movie/{tmdb_id}",
    url_tv: "https://player.smashy.stream/tv/{tmdb_id}?s={season}&e={episode}",
  },
  {
    name: "VidEasy (4K)",
    type: "tmdb",
    url: "https://player.videasy.net/movie/{tmdb_id}?color=8834ec",
    url_tv: "https://player.videasy.net/tv/{tmdb_id}/{season}/{episode}?color=8834ec",
  },
  {
    name: "Vidora",
    type: "tmdb",
    url: "https://vidora.su/movie/{tmdb_id}",
    url_tv: "https://vidora.su/tv/{tmdb_id}/{season}/{episode}",
  },
  {
    name: "VidSrcCC",
    type: "tmdb",
    url: "https://vidsrc.cc/v2/embed/movie/{tmdb_id}?autoPlay=false",
    url_tv: "https://vidsrc.cc/v2/embed/tv/{tmdb_id}/{season}/{episode}?autoPlay=false",
  },
  {
    name: "StreamFlix",
    type: "tmdb",
    url: "https://watch.streamflix.one/movie/{tmdb_id}/watch?server=1",
    url_tv: "https://watch.streamflix.one/tv/{tmdb_id}/watch?server=1&season={season}&episode={episode}",
  },
  {
    name: "NebulaFlix",
    type: "tmdb",
    url: "https://nebulaflix.stream/movie?mt={tmdb_id}&server=1",
    url_tv: "https://nebulaflix.stream/show?st={tmdb_id}&season={season}&episode={episode}&server=1",
  },
  {
    name: "VidZee",
    type: "tmdb",
    url: "https://player.vidzee.wtf/embed/movie/{tmdb_id}",
    url_tv: "https://player.vidzee.wtf/embed/tv/{tmdb_id}/{season}/{episode}",
  },
  {
    name: "Spenflix",
    type: "tmdb",
    url: "https://spencerdevs.xyz/movie/{tmdb_id}",
    url_tv: "https://spencerdevs.xyz/tv/{tmdb_id}/{season}/{episode}",
  },
  {
    name: "Frembed (FR)",
    type: "tmdb",
    url: "https://frembed.icu/api/film.php?id={tmdb_id}",
    url_tv: "https://frembed.icu/api/serie.php?id={tmdb_id}&sa={season}&epi={episode}",
  },
  {
    name: "UEmbed (premium)",
    type: "tmdb",
    url: "https://uembed.site/?id={tmdb_id}&apikey=thisisforsurenotapremiumkey_right?",
    url_tv: "https://uembed.site/?id={tmdb_id}&season={season}&episode={episode}&apikey=thisisforsurenotapremiumkey_right?",
  },
  {
    name: "VidSrc Download (Direct)",
    type: "tmdb",
    url: "https://dl.vidsrc.vip/movie/{tmdb_id}",
    url_tv: "https://dl.vidsrc.vip/tv/{tmdb_id}/{season}/{episode}",
  },
  {
    name: "BunnyDDL (Multi Quality)",
    type: "tmdb",
    url: "https://bunnyddl.termsandconditionshere.workers.dev/movie/{tmdb_id}",
    url_tv: "https://bunnyddl.termsandconditionshere.workers.dev/tv/{tmdb_id}/{season}/{episode}",
  },
];

// Download servers configuration
const downloadServers = [
  {
    name: "BunnyDDL",
    url: "https://bunnyddl.termsandconditionshere.workers.dev/movie/{tmdb_id}",
    url_tv: "https://bunnyddl.termsandconditionshere.workers.dev/tv/{tmdb_id}/{season}/{episode}",
    description: "Multiple quality options available",
    icon: "üê∞"
  },

    {
    name: "fast Direct",
    url: "https://02moviedownloader.site/api/download/movie/{imdb_id}",
    url_tv: "https://02moviedownloader.site/api/download/tv/{tmdb_id}/{season}/{episode}",
    description: "High quality with multiple options",
    icon: "‚úì"
  },  {
    name: "VidSrc Download",
    url: "https://dl.vidsrc.vip/movie/{tmdb_id}",
    url_tv: "https://dl.vidsrc.vip/tv/{tmdb_id}/{season}/{episode}",
    description: "Direct download links - fast & reliable",
    icon: "‚ö°"
  },
  {
    name: "seal All quality",
    url: "https://seashell-whale-304753.hostingersite.com/?s=${title}",
    description: "High quality torrents with multiple options",
    icon: "üåå"
  }
];


</script>


<script>
async function fetchFromTMDB(endpoint, params = new URLSearchParams()) {
  if (typeof API_KEY === 'undefined' || API_KEY === 'YOUR_TMDB_API_KEY') {
    console.error("TMDB API Key is not configured");
    return null;
  }
  
  params.set('api_key', API_KEY);
  
  // Add language parameter from localStorage - only with_original_language
  const savedLanguage = localStorage.getItem('vegaMovies_language');
  if (savedLanguage) {
    try {
      const language = JSON.parse(savedLanguage);
      if (language && language !== '' && language !== 'en') {
        params.set('with_original_language', language);
      }
    } catch (e) {
      // If savedLanguage is just a string, use it directly
      if (savedLanguage && savedLanguage !== '' && savedLanguage !== 'en') {
        params.set('with_original_language', savedLanguage);
      }
    }
  }
  
  const url = `${BASE_URL}/${endpoint}?${params.toString()}`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      console.error(`API Error: ${response.status} for URL: ${url}`);
      return null;
    }
    return await response.json();
  } catch (error) {
    console.error(`Fetch error for URL: ${url}`, error);
    return null;
  }
}

/**
 * Constructs the full URL for a TMDB image.
 */
function getImageUrl(path, size = 'w500') {
  if (!path) {
    return `https://placehold.co/500x750/222222/AAAAAA?text=No+Image`;
  }
  return `https://image.tmdb.org/t/p/${size}${path}`;
}

/**
 * Fetches detailed information for a specific movie or TV show.
 */
async function fetchDetails(type, id) {
  const params = new URLSearchParams();
  params.set('append_to_response', 'credits,videos,similar,images');
  params.set('include_image_language', 'en,null');
  return await fetchFromTMDB(`${type}/${id}`, params);
}

/**
 * Fetches details for a specific season of a TV show.
 */
async function fetchTvSeasonDetails(tvId, seasonNumber) {
  return await fetchFromTMDB(`tv/${tvId}/season/${seasonNumber}`);
}

/**
 * Fetches content from the /discover endpoint with various filters.
 */
async function fetchDiscover(type, filters) {
  return await fetchFromTMDB(`discover/${type}`, filters);
}

/**
 * Fetches the official list of genres for movies or TV shows.
 */
async function fetchGenres(type) {
  return await fetchFromTMDB(`genre/${type}/list`);
}

/**
 * Searches across movies, TV shows, and people using the multi-search endpoint.
 */
async function searchMulti(query, page = 1) {
  const params = new URLSearchParams();
  params.set('query', query);
  params.set('page', page);
  return await fetchFromTMDB('search/multi', params);
}

/**
 * Fetches trending content for the week.
 */
async function fetchTrending(type = 'movie', timeWindow = 'week') {
  return await fetchFromTMDB(`trending/${type}/${timeWindow}`);
}

/**
 * Fetches person details including known for credits
 */
async function fetchPersonDetails(personId) {
  const params = new URLSearchParams();
  params.set('append_to_response', 'movie_credits,tv_credits,images');
  return await fetchFromTMDB(`person/${personId}`, params);
}

/**
 * Fetches content from specific streaming platforms
 */
async function fetchByPlatform(type, platformId, page = 1) {
  const params = new URLSearchParams();
  params.set('with_watch_providers', platformId);
  params.set('watch_region', 'US');
  params.set('page', page);
  return await fetchFromTMDB(`discover/${type}`, params);
}
// app.js - Main application logic

document.addEventListener('DOMContentLoaded', () => {
  // --- STATE MANAGEMENT ---
  const state = {
    currentPage: null,
    currentPageNumber: 1,
    isLoading: false,
    currentFilters: {},
    currentGenre: { id: null, name: '' },
    currentPlatform: { id: null, name: '' },
    currentSearchQuery: '',
    allProviders: null,
  };

  // Cache for genres to avoid repeated API calls
  const genresMap = { movie: null, tv: null };
  
  // Streaming platforms
  const platforms = [
    { id: 8, name: 'Netflix', logo: 'üé¨' },
    { id: 9, name: 'Amazon Prime', logo: 'üì¶' },
    { id: 337, name: 'Disney Plus', logo: '‚ú®' },
    { id: 384, name: 'HBO Max', logo: 'üé≠' },
    { id: 15, name: 'Hulu', logo: 'üü¢' },
    { id: 350, name: 'Apple TV Plus', logo: 'üçé' },
    { id: 531, name: 'Paramount Plus', logo: '‚õ∞Ô∏è' },
    { id: 1899, name: 'Max', logo: 'üé™' }
  ];

  // --- DOM ELEMENTS ---
  const mainContent = document.querySelector('main');
  const pages = document.querySelectorAll('.page');
  const navItems = document.querySelectorAll('.nav-item');

  // --- LOCALSTORAGE HELPERS ---
  const getLocalStorage = (key, defaultValue) => JSON.parse(localStorage.getItem(key)) || defaultValue;
  const setLocalStorage = (key, value) => localStorage.setItem(key, JSON.stringify(value));

  // --- UTILITY FUNCTIONS ---
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // --- ROUTER ---
  function router() {
    const hash = window.location.hash || '#home';
    const [route, ...params] = hash.substring(1).split('/');
    navigateTo(route || 'home', params);
  }

  function navigateTo(route, params = []) {
    pages.forEach(page => page.classList.remove('active'));
    const targetPage = document.getElementById(route);
    if (targetPage) {
      targetPage.classList.add('active');
      window.scrollTo(0, 0);
      updateBottomNav(route);
      loadPageContent(route, params);
      state.currentPage = route;
    } else {
      navigateTo('home');
    }
  }

  function updateBottomNav(activeRoute) {
    navItems.forEach(item => {
      item.classList.toggle('active', item.dataset.route === activeRoute);
    });
  }

  // --- PAGE LOADERS ---
  async function loadPageContent(route, params) {
    if (['movies', 'tv', 'genre', 'platform', 'search'].includes(route)) {
      state.currentPageNumber = 1;
      state.isLoading = false;
    }
    switch (route) {
      case 'home': await loadHomePage(); break;
      case 'movies': await loadDiscoverPage('movie'); break;
      case 'tv': await loadDiscoverPage('tv'); break;
      case 'genre': await loadGenrePage(params[0]); break;
      case 'platform': await loadPlatformPage(params[0]); break;
      case 'actor': await loadActorPage(params[0]); break;
      case 'preview': await loadPreviewPage(params[0], params[1]); break;
      case 'play': 
        if (typeof loadPlayerPage === 'function') {
          await loadPlayerPage(params[0], params[1], params[2], params[3]);
        }
        break;
      case 'profile': loadProfilePage(); break;
      case 'search': loadSearchPage(); break;
    }
  }

  // --- RENDER FUNCTIONS ---
  function renderCards(container, items, type, append = false) {
    if (!append) container.innerHTML = '';
    if (!items || items.length === 0) {
      if (!append) container.innerHTML = '<p style="padding: 1rem;">No content found.</p>';
      return;
    }
    
    const fragment = document.createDocumentFragment();
    items.forEach(item => {
      const itemType = type || item.media_type || (item.first_air_date ? 'tv' : 'movie');
      if (itemType === 'person' || !item.poster_path) return;

      const rating = item.vote_average ? item.vote_average.toFixed(1) : '0.0';
      const ratingPercent = (item.vote_average * 10);
      const offset = 100 - ratingPercent;

      const card = document.createElement('a');
      card.className = 'content-card';
      card.href = `#preview/${itemType}/${item.id}`;
      card.innerHTML = `
        <div class="card-rating-circle">
          <svg viewBox="0 0 36 36">
            <circle class="rating-bg" cx="18" cy="18" r="15.5"></circle>
            <circle class="rating-val" cx="18" cy="18" r="15.5" stroke-dashoffset="${offset}"></circle>
          </svg>
          <span class="rating-text">${rating}</span>
        </div>
        <img src="${getImageUrl(item.poster_path, 'w342')}" alt="${item.title || item.name}" class="card-poster" loading="lazy">
        <div class="card-info">
          <h3 class="card-title">${item.title || item.name}</h3>
          <div class="card-meta">
            <span>${(item.release_date || item.first_air_date || '').substring(0, 4)}</span>
            <span class="card-type">${itemType === 'tv' ? 'TV' : 'Movie'}</span>
          </div>
        </div>
      `;
      fragment.appendChild(card);
    });
    container.appendChild(fragment);
  }

  // --- HOME PAGE ---
  async function loadHomePage() {
    const carouselContainer = document.querySelector('.hero-carousel-container');
    const popularMoviesContainer = document.getElementById('popular-movies');
    const popularTVContainer = document.getElementById('popular-tv');
    const actionContainer = document.getElementById('action-movies');
    const crimeContainer = document.getElementById('crime-movies');
    const comedyContainer = document.getElementById('comedy-movies');
    const horrorContainer = document.getElementById('horror-movies');
    
    // Fetch hero carousel and popular content
    const carouselParams = new URLSearchParams({ sort_by: 'popularity.desc', page: 1 });
    const popularMoviesParams = new URLSearchParams({ sort_by: 'popularity.desc', page: 1 });
    const popularTVParams = new URLSearchParams({ sort_by: 'popularity.desc', page: 1 });
    
    // Genre IDs: Action=28, Crime=80, Comedy=35, Horror=27
    const actionParams = new URLSearchParams({ with_genres: '28', sort_by: 'popularity.desc', page: 1 });
    const crimeParams = new URLSearchParams({ with_genres: '80', sort_by: 'popularity.desc', page: 1 });
    const comedyParams = new URLSearchParams({ with_genres: '35', sort_by: 'popularity.desc', page: 1 });
    const horrorParams = new URLSearchParams({ with_genres: '27', sort_by: 'popularity.desc', page: 1 });
    
    const [carouselData, popularMovies, popularTV, actionMovies, crimeMovies, comedyMovies, horrorMovies] = await Promise.all([
      fetchDiscover('movie', carouselParams),
      fetchDiscover('movie', popularMoviesParams),
      fetchDiscover('tv', popularTVParams),
      fetchDiscover('movie', actionParams),
      fetchDiscover('movie', crimeParams),
      fetchDiscover('movie', comedyParams),
      fetchDiscover('movie', horrorParams)
    ]);

    // Render hero carousel
    if (carouselData?.results) {
      carouselContainer.classList.remove('skeleton');
      renderHeroCarousel(carouselData.results.slice(0, 5));
    }
    
    // Render sections
    if (popularMovies?.results) {
      renderCards(popularMoviesContainer, popularMovies.results, 'movie');
    }
    
    if (popularTV?.results) {
      renderCards(popularTVContainer, popularTV.results, 'tv');
    }
    
    if (actionMovies?.results) {
      renderCards(actionContainer, actionMovies.results, 'movie');
    }
    
    if (crimeMovies?.results) {
      renderCards(crimeContainer, crimeMovies.results, 'movie');
    }
    
    if (comedyMovies?.results) {
      renderCards(comedyContainer, comedyMovies.results, 'movie');
    }
    
    if (horrorMovies?.results) {
      renderCards(horrorContainer, horrorMovies.results, 'movie');
    }
  }

  function renderHeroCarousel(items) {
    const container = document.querySelector('.hero-carousel-container');
    container.innerHTML = '';
    if (!items) return;

    items.forEach((item, index) => {
      const slide = document.createElement('div');
      slide.className = `hero-slide ${index === 0 ? 'active' : ''}`;
      slide.innerHTML = `
        <img src="${getImageUrl(item.backdrop_path, 'w780')}" class="hero-backdrop" alt="${item.title}">
        <div class="hero-overlay">
          <div class="hero-content">
            <img src="${getImageUrl(item.poster_path, 'w342')}" class="hero-poster" alt="Poster">
            <div class="hero-details">
              <h2 class="hero-title-text">${item.title}</h2>
              <div class="hero-meta">
                <span class="hero-rating">‚≠ê ${item.vote_average.toFixed(1)}</span>
                <span>${(item.release_date || '').substring(0, 4)}</span>
              </div>
              <a href="#play/movie/${item.id}" class="btn btn-primary">‚ñ∂ Watch Now</a>
            </div>
          </div>
        </div>
      `;
      container.appendChild(slide);
    });

    let currentSlide = 0;
    if (container.carouselInterval) clearInterval(container.carouselInterval);
    container.carouselInterval = setInterval(() => {
      const slides = container.querySelectorAll('.hero-slide');
      if (slides.length === 0) return;
      slides[currentSlide].classList.remove('active');
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].classList.add('active');
    }, 5000);
  }

  function renderPlatforms(container) {
    container.innerHTML = '';
    const fragment = document.createDocumentFragment();
    
    platforms.forEach(platform => {
      const card = document.createElement('div');
      card.className = 'platform-card';
      card.innerHTML = `
        <div class="platform-logo">${platform.logo}</div>
        <h3 class="platform-name">${platform.name}</h3>
      `;
      card.onclick = () => {
        window.location.hash = `#platform/${platform.id}`;
      };
      fragment.appendChild(card);
    });
    
    container.appendChild(fragment);
  }

  // --- DISCOVER / GENRE / PLATFORM PAGES ---
  async function setupFilters(container, type) {
    if (!genresMap[type]) {
      const genreData = await fetchGenres(type);
      genresMap[type] = genreData.genres;
    }
    
    const genres = genresMap[type] || [];
    const currentYear = new Date().getFullYear();
    const years = Array.from({length: 30}, (_, i) => currentYear - i);
    
    const languages = [
      { code: '', name: 'All Languages' },
      { code: 'en', name: 'English' },
      { code: 'hi', name: 'Hindi' },
      { code: 'es', name: 'Spanish' },
      { code: 'fr', name: 'French' },
      { code: 'de', name: 'German' },
      { code: 'ja', name: 'Japanese' },
      { code: 'ko', name: 'Korean' },
      { code: 'zh', name: 'Chinese' }
    ];
    
    const savedLanguage = getLocalStorage('vegaMovies_language', '');

    container.innerHTML = `
      <select name="sort_by" data-type="${type}">
        <option value="popularity.desc">Most Popular</option>
        <option value="vote_average.desc">Highest Rated</option>
        <option value="vote_count.desc">Most Voted</option>
        <option value="release_date.desc">Latest Release</option>
        <option value="revenue.desc">Highest Revenue</option>
      </select>
      <select name="with_genres" data-type="${type}">
        <option value="">All Genres</option>
        ${genres.map(g => `<option value="${g.id}">${g.name}</option>`).join('')}
      </select>
      <select name="primary_release_year" data-type="${type}">
        <option value="">Any Year</option>
        ${years.map(y => `<option value="${y}">${y}</option>`).join('')}
      </select>
      <select name="with_original_language" data-type="${type}" class="filter-language-selector">
        ${languages.map(lang => `<option value="${lang.code}" ${savedLanguage === lang.code ? 'selected' : ''}>${lang.name}</option>`).join('')}
      </select>
    `;
    
    // Add language change listener for filter bar
    const languageSelect = container.querySelector('.filter-language-selector');
    if (languageSelect) {
      languageSelect.addEventListener('change', (e) => {
        const selectedLang = e.target.value;
        // Don't save to localStorage, just trigger filter reload with temporary language
        state.currentPageNumber = 1;
        executeFilter(type, false);
      });
    }
  }

  async function loadDiscoverPage(type) {
    const filterBar = document.getElementById(`${type === 'movie' ? 'movies' : 'tv'}-filter-bar`);
    await setupFilters(filterBar, type);
    await executeFilter(type);
  }

  async function executeFilter(type, append = false) {
    if (state.isLoading) return;
    state.isLoading = true;
    
    let grid, filterBar;
    
    if (state.currentPage === 'genre') {
      grid = document.getElementById('genre-grid');
      filterBar = document.getElementById('genre-filter-bar');
    } else if (state.currentPage === 'platform') {
      grid = document.getElementById('platform-grid');
      filterBar = document.getElementById('platform-filter-bar');
    } else {
      grid = document.getElementById(`${type === 'movie' ? 'movies' : 'tv'}-grid`);
      filterBar = document.getElementById(`${type === 'movie' ? 'movies' : 'tv'}-filter-bar`);
    }
    
    if (!grid || !filterBar) {
      state.isLoading = false;
      return;
    }
    
    const params = new URLSearchParams();
    filterBar.querySelectorAll('select').forEach(select => {
      if (select.value) {
        params.set(select.name, select.value);
      }
    });
    
    if(state.currentPage === 'genre' && state.currentGenre.id) {
      params.set('with_genres', state.currentGenre.id);
    }
    
    if(state.currentPage === 'platform' && state.currentPlatform.id) {
      params.set('with_watch_providers', state.currentPlatform.id);
      params.set('watch_region', 'IN');
      params.set('with_watch_monetization_types', 'flatrate');
    }
    
    params.set('page', state.currentPageNumber);
    
    const data = await fetchDiscover(type, params);
    if(data?.results) {
      renderCards(grid, data.results, type, append);
    }
    
    state.isLoading = false;
  }

  async function loadGenrePage(genreId) {
    const grid = document.getElementById('genre-grid');
    grid.innerHTML = '';
    state.currentGenre.id = genreId;
    state.currentPageNumber = 1;
    state.isLoading = false;
    
    const type = document.querySelector('#genre-tab-switcher .tab-btn.active')?.dataset.type || 'movie';
    
    if (!genresMap.movie) genresMap.movie = (await fetchGenres('movie')).genres;
    if (!genresMap.tv) genresMap.tv = (await fetchGenres('tv')).genres;
    
    const genre = genresMap.movie.find(g => g.id == genreId) || genresMap.tv.find(g => g.id == genreId);
    document.getElementById('genre-title').textContent = genre ? genre.name : 'Genre';
    
    const filterBar = document.getElementById('genre-filter-bar');
    await setupFilters(filterBar, type);
    await executeFilter(type);
  }

  async function loadPlatformPage(platformId) {
    const providersView = document.querySelector('.platform-providers-view');
    const contentView = document.querySelector('.platform-content-view');
    const grid = document.getElementById('platform-grid');
    const titleElement = document.getElementById('platform-title');
    const tabSwitcher = document.getElementById('platform-tab-switcher');
    
    // If no platformId, show all platforms from API
    if (!platformId) {
      providersView.style.display = 'block';
      contentView.style.display = 'none';
      
      // Setup platform providers search
      const providersSearchInput = document.getElementById('platform-providers-search-input');
      if (providersSearchInput) {
        providersSearchInput.addEventListener('input', debounce((e) => {
          loadPlatformProviders(e.target.value.trim());
        }, 300));
      }
      
      await loadPlatformProviders();
      return;
    }
    
    // Show specific platform content
    providersView.style.display = 'none';
    contentView.style.display = 'block';
    grid.innerHTML = '';
    state.currentPlatform.id = platformId;
    state.currentPlatform.name = decodeURIComponent(new URLSearchParams(window.location.hash.split('?')[1] || '').get('name') || 'Platform');
    state.currentPageNumber = 1;
    state.isLoading = false;
    
    const type = document.querySelector('#platform-tab-switcher .tab-btn.active')?.dataset.type || 'movie';
    titleElement.textContent = state.currentPlatform.name;
    
    // Setup search box
    const searchInput = document.getElementById('platform-search-input');
    if (searchInput) {
      searchInput.value = '';
      searchInput.addEventListener('input', debounce((e) => {
        state.currentPageNumber = 1;
        grid.innerHTML = '';
        loadPlatformContent(type, e.target.value.trim());
      }, 500));
    }
    
    await loadPlatformContent(type);
  }

  async function loadPlatformProviders(searchQuery = '') {
    const gridElement = document.getElementById('platform-providers-grid');
    
    if (!state.allProviders) {
      gridElement.innerHTML = '<div class="loader" style="display:block; position:relative; margin: 2rem auto;"></div>';
      
      try {
        const response = await fetch(`https://api.themoviedb.org/3/watch/providers/movie?api_key=${API_KEY}&watch_region=IN`);
        const data = await response.json();
        
        if (!data.results || data.results.length === 0) {
          gridElement.innerHTML = '<p>No providers found</p>';
          return;
        }
        
        state.allProviders = data.results
          .filter(p => p.logo_path)
          .sort((a, b) => (a.display_priority ?? 99) - (b.display_priority ?? 99));
      } catch (error) {
        console.error('Error loading providers:', error);
        gridElement.innerHTML = '<p>Error loading providers</p>';
        return;
      }
    }
    
    // Filter providers by search query
    let filteredProviders = state.allProviders;
    if (searchQuery) {
      filteredProviders = state.allProviders.filter(p => 
        p.provider_name.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }
    
    // Render filtered providers
    gridElement.innerHTML = '';
    
    if (filteredProviders.length === 0) {
      gridElement.innerHTML = '<p style="padding: 1rem; text-align: center;">No platforms found</p>';
      return;
    }
    
    const fragment = document.createDocumentFragment();
    
    filteredProviders.forEach(provider => {
      const card = document.createElement('div');
      card.className = 'platform-provider-card';
      card.innerHTML = `
        <img src="https://image.tmdb.org/t/p/w200${provider.logo_path}" alt="${provider.provider_name}">
        <div class="platform-provider-name">${provider.provider_name}</div>
      `;
      card.onclick = () => {
        window.location.hash = `#platform/${provider.provider_id}?name=${encodeURIComponent(provider.provider_name)}`;
      };
      fragment.appendChild(card);
    });
    
    gridElement.appendChild(fragment);
  }

  async function loadPlatformContent(type, searchQuery = '') {
    if (state.isLoading) return;
    state.isLoading = true;
    
    const grid = document.getElementById('platform-grid');
    const loader = document.querySelector('.platform-loader');
    if (loader) loader.style.display = 'block';
    
    const params = new URLSearchParams({
      with_watch_providers: state.currentPlatform.id,
      with_watch_monetization_types: 'flatrate',
      watch_region: 'IN',
      sort_by: 'popularity.desc',
      page: state.currentPageNumber
    });
    
    if (searchQuery) {
      params.set('query', searchQuery);
    }
    
    const data = await fetchDiscover(type, params);
    if (data?.results) {
      renderCards(grid, data.results, type, state.currentPageNumber > 1);
    } else if (state.currentPageNumber === 1) {
      grid.innerHTML = '<p style="padding: 1rem;">No content found for this platform.</p>';
    }
    
    if (loader) loader.style.display = 'none';
    state.isLoading = false;
  }

  // --- ACTOR PAGE ---
  async function loadActorPage(personId) {
    const container = document.querySelector('.actor-profile-container');
    container.innerHTML = '<div class="loader" style="display:block; position:relative; margin: 2rem auto;"></div>';
    
    const data = await fetchPersonDetails(personId);
    if (!data) {
      container.innerHTML = '<p class="error-message">Failed to load actor details.</p>';
      return;
    }

    const knownFor = [
      ...(data.movie_credits?.cast || []).slice(0, 10),
      ...(data.tv_credits?.cast || []).slice(0, 10)
    ].sort((a, b) => (b.popularity || 0) - (a.popularity || 0)).slice(0, 12);

    container.innerHTML = `
      <div class="actor-banner">
        <img src="${getImageUrl(data.profile_path, 'w500')}" class="actor-profile-image" alt="${data.name}">
        <h1 class="actor-profile-name">${data.name}</h1>
        <div class="actor-profile-info">
          ${data.birthday ? `<p>Born: ${data.birthday} üéä ${data.place_of_birth ? ` in üß≠ ${data.place_of_birth}Ô∏è` : ''}</p>` : ''}
          ${data.known_for_department ? `<p>üì¢ Known for: ${data.known_for_department}</p>` : ''}
        </div>
      </div>
      ${data.biography ? `
        <div class="actor-bio">
          <h3>Biography</h3>
          <p>${data.biography}</p>
        </div>
      ` : ''}
      <div class="actor-known-for">
        <h3>Known For</h3>
        <div class="grid-container" id="actor-known-for-grid"></div>
      </div>
    `;

    if (knownFor.length > 0) {
      const knownForGrid = container.querySelector('#actor-known-for-grid');
      renderCards(knownForGrid, knownFor);
    }
  }

  // --- PREVIEW PAGE ---
  async function loadPreviewPage(type, id) {
    const container = document.getElementById('preview');
    container.innerHTML = '<div class="loader" style="display:block;"></div>';
    
    const data = await fetchDetails(type, id);
    if (!data) {
      container.innerHTML = '<p class="error-message">Failed to load content details.</p>';
      return;
    }

    const title = data.title || data.name;
    const releaseDate = data.release_date || data.first_air_date;
    const runtime = data.runtime || (data.episode_run_time ? data.episode_run_time[0] : null);
    const logo = data.images?.logos?.find(l => l.iso_639_1 === 'en');
    const trailer = data.videos?.results?.find(v => v.type === 'Trailer');

    container.innerHTML = `
      <div class="preview-banner">
        <img src="${getImageUrl(data.backdrop_path, 'original')}" class="preview-backdrop" alt="">
        <div class="preview-banner-overlay"></div>
        <div class="preview-header">
          <img src="${getImageUrl(data.poster_path, 'w500')}" class="preview-poster" alt="${title}">
          <div class="preview-title-section">
            ${logo ? `<img src="${getImageUrl(logo.file_path)}" class="preview-logo" alt="${title} logo">` : `<h2 class="preview-title-text">${title}</h2>`}
            ${data.tagline ? `<p class="preview-tagline">${data.tagline}</p>` : ''}
          </div>
        </div>
      </div>
      <div class="preview-content">
        <div class="preview-main-content">
          <div class="preview-actions">
            <a href="#play/${type}/${id}" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
              Watch Now
            </a>
            <button class="btn btn-outline" id="like-btn" data-id="${id}" data-type="${type}">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
              Like
            </button>
            <a href="#play/${type}/${id}" class="download-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Download
            </a>
          </div>
          <div class="preview-details-panel">
            <div class="detail-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              ${data.vote_average.toFixed(1)} (${data.vote_count} votes)
            </div>
            ${releaseDate ? `<div class="detail-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              ${releaseDate}
            </div>` : ''}
            ${runtime ? `<div class="detail-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              ${runtime} minutes
            </div>` : ''}
            <div class="genre-chips">${data.genres.map(g => `<a href="#genre/${g.id}" class="genre-chip">${g.name}</a>`).join('')}</div>
          </div>
          <p class="preview-overview">${data.overview}</p>
          ${trailer ? `
            <div class="trailer-container">
              <h3>Trailer</h3>
              <div class="trailer-embed">
                <iframe src="https://www.youtube.com/embed/${trailer.key}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
              </div>
            </div>
          ` : ''}
        </div>
        <div class="preview-side-content">
          <div class="cast-container">
            <h3>Cast</h3>
            <div class="horizontal-scroll-container">${data.credits.cast.slice(0, 15).map(actor => `
              <a href="#actor/${actor.id}" class="actor-card">
                <img src="${getImageUrl(actor.profile_path, 'w185')}" class="actor-image" alt="${actor.name}" loading="lazy">
                <p class="actor-name">${actor.name}</p>
                <p class="actor-character">${actor.character}</p>
              </a>`).join('')}
            </div>
          </div>
          ${data.similar.results.length > 0 ? `
            <div class="similar-container">
              <h3>Similar</h3>
              <div class="grid-container" id="similar-grid"></div>
            </div>
          `: ''}
        </div>
      </div>
    `;

    if (data.similar.results.length > 0) {
      renderCards(container.querySelector('#similar-grid'), data.similar.results, type);
    }

    updateLikeButtonState(id);
  }

  // --- PROFILE PAGE ---
  function loadProfilePage() {
    const profile = getLocalStorage('vegaMovies_profile', { name: 'Guest User', avatar: '' });
    document.getElementById('profile-name').textContent = profile.name;
    document.getElementById('profile-avatar-img').src = profile.avatar || `https://placehold.co/150x150/7c3aed/FFFFFF?text=${profile.name.charAt(0)}`;

    const activeTab = document.querySelector('#profile-tab-switcher .tab-btn.active').dataset.content;
    if(activeTab === 'history') loadWatchHistory();
    else loadLikedContent();
  }

  function loadWatchHistory() {
    const history = getLocalStorage('vegaMovies_watchHistory', []);
    const container = document.getElementById('watch-history-list');
    if (history.length === 0) {
      container.innerHTML = '<p>No watch history yet.</p>';
      return;
    }

    const timeAgo = (timestamp) => {
      const seconds = Math.floor((new Date() - timestamp) / 1000);
      let interval = seconds / 31536000;
      if (interval > 1) return Math.floor(interval) + " years ago";
      interval = seconds / 2592000;
      if (interval > 1) return Math.floor(interval) + " months ago";
      interval = seconds / 86400;
      if (interval > 1) return Math.floor(interval) + " days ago";
      interval = seconds / 3600;
      if (interval > 1) return Math.floor(interval) + " hours ago";
      interval = seconds / 60;
      if (interval > 1) return Math.floor(interval) + " minutes ago";
      return "Just now";
    };

    container.innerHTML = history.map(item => `
      <div class="history-item">
        <img src="${getImageUrl(item.poster_path, 'w185')}" class="history-poster" alt="${item.title}">
        <div class="history-info">
          <h4>${item.title}</h4>
          <p>Watched ${timeAgo(item.timestamp)}</p>
        </div>
        <a href="#play/${item.type}/${item.id}" class="history-view-btn">View</a>
      </div>
    `).join('');
  }

  async function loadLikedContent() {
    const liked = getLocalStorage('vegaMovies_likedContent', []);
    const container = document.getElementById('liked-grid');
    if (liked.length === 0) {
      container.innerHTML = '<p>You haven\'t liked any content yet.</p>';
      return;
    }

    const likedItemsDetails = await Promise.all(
      liked.map(item => fetchDetails(item.type, item.id))
    );
    renderCards(container, likedItemsDetails.filter(Boolean));
  }

  // --- SEARCH PAGE ---
  function loadSearchPage() {
    const searchInput = document.getElementById('search-input');
    if (state.currentSearchQuery) {
      searchInput.value = state.currentSearchQuery;
      executeSearch(state.currentSearchQuery);
    }
  }

  async function executeSearch(query, append = false) {
    if (state.isLoading) return;
    state.isLoading = true;
    const grid = document.getElementById('search-results-grid');
    const results = await searchMulti(query, state.currentPageNumber);
    if (results?.results) {
      renderCards(grid, results.results, null, append);
    }
    state.isLoading = false;
  }

  // --- LOCALSTORAGE & USER ACTIONS ---
  function saveToHistory(item) {
    if (!item || !item.id) {
      console.warn('‚ö†Ô∏è Invalid item for history:', item);
      return;
    }
    try {
      let history = getLocalStorage('vegaMovies_watchHistory', []);
      history = history.filter(h => h.id !== item.id);
      history.unshift({ ...item, timestamp: Date.now() });
      setLocalStorage('vegaMovies_watchHistory', history.slice(0, 50));
      console.log('‚úÖ Saved to history:', item.title || item.name);
    } catch (error) {
      console.error('‚ùå Error saving to history:', error);
    }
  }
  
  // Make saveToHistory globally accessible
  window.saveToHistory = saveToHistory;

  function toggleLike(id, type) {
    let liked = getLocalStorage('vegaMovies_likedContent', []);
    const itemIndex = liked.findIndex(item => item.id == id);

    if (itemIndex > -1) {
      liked.splice(itemIndex, 1);
    } else {
      liked.push({ id, type });
    }
    setLocalStorage('vegaMovies_likedContent', liked);
    updateLikeButtonState(id);
  }

  function updateLikeButtonState(id) {
    const likeBtn = document.getElementById('like-btn');
    if (!likeBtn) return;
    const likedContent = getLocalStorage('vegaMovies_likedContent', []);
    const isLiked = likedContent.some(item => item.id == id);
    likeBtn.classList.toggle('active', isLiked);
    likeBtn.innerHTML = isLiked ? '‚ù§ Liked' : '‚ù§ Like';
  }

  // --- INFINITE SCROLL ---
  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting && !state.isLoading) {
      state.currentPageNumber++;
      const page = state.currentPage;

      if (page === 'movies' || page === 'tv') {
        const type = page === 'movies' ? 'movie' : 'tv';
        executeFilter(type, true);
      } else if (page === 'search' && state.currentSearchQuery) {
        executeSearch(state.currentSearchQuery, true);
      } else if(page === 'genre') {
        const type = document.querySelector('#genre-tab-switcher .tab-btn.active').dataset.type;
        executeFilter(type, true);
      } else if(page === 'platform') {
        const type = document.querySelector('#platform-tab-switcher .tab-btn.active')?.dataset.type || 'movie';
        const searchInput = document.getElementById('platform-search-input');
        loadPlatformContent(type, searchInput?.value.trim() || '');
      }
    }
  }, { rootMargin: '200px' });

  document.querySelectorAll('.sentinel').forEach(el => observer.observe(el));

  // --- EVENT LISTENERS ---
  window.addEventListener('hashchange', router);

  // Delegated event listener for main content area
  mainContent.addEventListener('click', e => {
    // Like Button
    if (e.target.id === 'like-btn') {
      const { id, type } = e.target.dataset;
      toggleLike(id, type);
    }

    // Genre page tabs
    const genreTab = e.target.closest('#genre-tab-switcher .tab-btn');
    if(genreTab) {
      document.querySelectorAll('#genre-tab-switcher .tab-btn').forEach(t => t.classList.remove('active'));
      genreTab.classList.add('active');
      loadGenrePage(state.currentGenre.id);
    }

    // Platform page tabs
    const platformTab = e.target.closest('#platform-tab-switcher .tab-btn');
    if(platformTab) {
      document.querySelectorAll('#platform-tab-switcher .tab-btn').forEach(t => t.classList.remove('active'));
      platformTab.classList.add('active');
      state.currentPageNumber = 1;
      const grid = document.getElementById('platform-grid');
      const searchInput = document.getElementById('platform-search-input');
      grid.innerHTML = '';
      loadPlatformContent(platformTab.dataset.type, searchInput?.value.trim() || '');
    }

    // Profile page tabs
    const profileTab = e.target.closest('#profile-tab-switcher .tab-btn');
    if (profileTab) {
      document.querySelectorAll('#profile-tab-switcher .tab-btn').forEach(t => t.classList.remove('active'));
      profileTab.classList.add('active');
      document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'));
      const contentId = profileTab.dataset.content + '-content';
      document.getElementById(contentId).classList.add('active');
      if(profileTab.dataset.content === 'liked') loadLikedContent();
      else loadWatchHistory();
    }

    // Profile Edit button
    const profileName = document.getElementById('profile-name');
    if (e.target.id === 'edit-profile-btn' || e.target === profileName) {
      profileName.contentEditable = 'true';
      profileName.focus();
    }

    // Profile Avatar click
    if (e.target.id === 'profile-avatar-img') {
      document.getElementById('avatar-upload').click();
    }

    // Clear History button
    if(e.target.id === 'clear-history-btn') {
      setLocalStorage('vegaMovies_watchHistory', []);
      loadWatchHistory();
    }

    // Show More button for trending
    if(e.target.id === 'show-more-trending') {
      navigateTo('movies');
    }
  });

  // Delegated event listener for filter changes
  mainContent.addEventListener('change', e => {
    if(e.target.tagName === 'SELECT' && e.target.closest('.filter-bar')) {
      state.currentPageNumber = 1;
      executeFilter(e.target.dataset.type);
    }

    // Server dropdown change
    if (e.target.id === 'server-dropdown' && typeof loadServer === 'function') {
      const serverIndex = parseInt(e.target.value);
      if (!isNaN(serverIndex)) {
        loadServer(serverIndex);
      }
    }
  });

  // Profile name save on blur
  document.getElementById('profile-name').addEventListener('blur', e => {
    e.target.contentEditable = 'false';
    const profile = getLocalStorage('vegaMovies_profile', {});
    profile.name = e.target.textContent.trim();
    setLocalStorage('vegaMovies_profile', profile);
  });

  // Avatar upload handler
  document.getElementById('avatar-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = event => {
        const avatarDataUrl = event.target.result;
        document.getElementById('profile-avatar-img').src = avatarDataUrl;
        const profile = getLocalStorage('vegaMovies_profile', {});
        profile.avatar = avatarDataUrl;
        setLocalStorage('vegaMovies_profile', profile);
      }
      reader.readAsDataURL(file);
    }
  });

  // Search Input Logic
  const searchInput = document.getElementById('search-input');
  const clearBtn = document.getElementById('clear-search-btn');
  let debounceTimeout;
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim();
    clearBtn.style.display = query ? 'block' : 'none';
    clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
      state.currentSearchQuery = query;
      state.currentPageNumber = 1;
      if (query) {
        executeSearch(query);
      } else {
        document.getElementById('search-results-grid').innerHTML = '';
      }
    }, 300);
  });

  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    clearBtn.style.display = 'none';
    document.getElementById('search-results-grid').innerHTML = '';
    state.currentSearchQuery = '';
  });

  // Theme toggle
  document.querySelector('.theme-btn').addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    setLocalStorage('vegaMovies_theme', newTheme);
  });

  // Language modal on first visit
  const languageModal = document.getElementById('language-modal');
  const hasSelectedLanguage = getLocalStorage('vegaMovies_languageSelected', false);
  
  if (!hasSelectedLanguage) {
    languageModal.classList.add('active');
  }
  
  // Language option selection
  document.querySelectorAll('.language-option').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      const flag = btn.dataset.flag;
      const name = btn.dataset.name;
      
      setLocalStorage('vegaMovies_language', lang);
      setLocalStorage('vegaMovies_languageFlag', flag);
      setLocalStorage('vegaMovies_languageName', name);
      setLocalStorage('vegaMovies_languageSelected', true);
      
      // Update header selector
      const selector = document.getElementById('language-selector');
      if (selector) selector.value = lang;
      
      languageModal.classList.remove('active');
    });
  });

  // Menu button - handled by navigation.js
  // Removed alert

  // Language selector
  const languageSelector = document.getElementById('language-selector');
  if (languageSelector) {
    languageSelector.addEventListener('change', (e) => {
      const selectedLanguage = e.target.value;
      if (selectedLanguage) {
        setLocalStorage('vegaMovies_language', selectedLanguage);
        // Reload current page with new language
        const currentRoute = state.currentPage;
        const currentHash = window.location.hash;
        window.location.hash = currentHash; // Force reload
        location.reload();
      }
    });
  }

// --- INITIALIZATION ---
const savedTheme = getLocalStorage('vegaMovies_theme', 'dark');
document.documentElement.setAttribute('data-theme', savedTheme);

// Language init (no prompt)
const savedLanguage = getLocalStorage('vegaMovies_language', 'en');
setLocalStorage('vegaMovies_language', savedLanguage);

if (languageSelector) {
  languageSelector.value = savedLanguage;
}

router();
});

// navigation.js - Off-canvas menu with genres

document.addEventListener('DOMContentLoaded', async () => {
  const menuBtn = document.querySelector('.menu-btn');
  const offCanvas = document.getElementById('offcanvas-menu');
  const offCanvasClose = document.querySelector('.offcanvas-close');
  const offCanvasOverlay = document.querySelector('.offcanvas-overlay');
  
  // Toggle off-canvas menu
  menuBtn?.addEventListener('click', () => {
    offCanvas?.classList.add('active');
    offCanvasOverlay?.classList.add('active');
    document.body.style.overflow = 'hidden';
  });
  
  // Close menu
  const closeMenu = () => {
    offCanvas?.classList.remove('active');
    offCanvasOverlay?.classList.remove('active');
    document.body.style.overflow = '';
  };
  
  offCanvasClose?.addEventListener('click', closeMenu);
  offCanvasOverlay?.addEventListener('click', closeMenu);
  
  // Load genres
  await loadGenresMenu();
});

async function loadGenresMenu() {
  const movieGenresContainer = document.getElementById('movie-genres-list');
  const tvGenresContainer = document.getElementById('tv-genres-list');
  
  if (!movieGenresContainer || !tvGenresContainer) return;
  
  try {
    // Fetch movie and TV genres
    const [movieGenres, tvGenres] = await Promise.all([
      fetchGenres('movie'),
      fetchGenres('tv')
    ]);
    
    // Render movie genres
    if (movieGenres?.genres) {
      movieGenresContainer.innerHTML = movieGenres.genres.map(genre => `
        <a href="#genre/${genre.id}" class="genre-link" data-genre-id="${genre.id}" data-genre-name="${genre.name}">
          ${genre.name}
        </a>
      `).join('');
    }
    
    // Render TV genres
    if (tvGenres?.genres) {
      tvGenresContainer.innerHTML = tvGenres.genres.map(genre => `
        <a href="#genre/${genre.id}" class="genre-link" data-genre-id="${genre.id}" data-genre-name="${genre.name}">
          ${genre.name}
        </a>
      `).join('');
    }
    
    // Close menu when genre clicked
    document.querySelectorAll('.genre-link').forEach(link => {
      link.addEventListener('click', () => {
        document.getElementById('offcanvas-menu')?.classList.remove('active');
        document.querySelector('.offcanvas-overlay')?.classList.remove('active');
        document.body.style.overflow = '';
      });
    });
    
  } catch (error) {
    console.error('Error loading genres:', error);
    movieGenresContainer.innerHTML = '<p style="color: var(--text-secondary); padding: 0.5rem;">Failed to load genres</p>';
    tvGenresContainer.innerHTML = '<p style="color: var(--text-secondary); padding: 0.5rem;">Failed to load genres</p>';
  }
}
// player.js - Player functionality

console.log('Player.js loaded');

// Current player state
let currentPlayerState = {
  type: null,
  id: null,
  season: null,
  episode: null,
  imdbId: null
};

// Popular Movies State
let popularMoviesState = {
  currentPage: 1,
  isLoading: false,
  hasMore: true
};

/**
 * Set player source function
 */
function setPlayerSrc(url) {
  const loader = document.querySelector('#play .loader');
  const playerIframe = document.getElementById('video-player-iframe');
  
  if (loader && playerIframe) {
    loader.style.display = 'block';
    playerIframe.src = url;
    
    playerIframe.onload = () => {
      loader.style.display = 'none';
    };
    
    playerIframe.onerror = () => {
      loader.style.display = 'none';
      console.error('Failed to load video from:', url);
    };
  }
}

/**
 * Load player page
 */
async function loadPlayerPage(type, id, season = 1, episode = 1) {
  console.log('üé¨ Loading player page:', { type, id, season, episode });
  
  const playerIframe = document.getElementById('video-player-iframe');
  const loader = document.querySelector('#play .loader');
  const serverDropdown = document.getElementById('server-dropdown');
  const seasonDetailsContainer = document.querySelector('.tv-season-details');
  const popularMoviesContainer = document.getElementById('popular-movies-grid');
  const downloadButtonsGrid = document.getElementById('download-buttons-grid');

  console.log('üîç Elements found:', {
    playerIframe: !!playerIframe,
    loader: !!loader,
    serverDropdown: !!serverDropdown,
    seasonDetailsContainer: !!seasonDetailsContainer,
    popularMoviesContainer: !!popularMoviesContainer,
    downloadButtonsGrid: !!downloadButtonsGrid
  });

  currentPlayerState = {
    type,
    id,
    season,
    episode,
    imdbId: null
  };

  if (loader) loader.style.display = 'block';
  if (playerIframe) playerIframe.src = 'about:blank';
  if (seasonDetailsContainer) seasonDetailsContainer.innerHTML = '';

  popularMoviesState = {
    currentPage: 1,
    isLoading: false,
    hasMore: true
  };

  if (serverDropdown) {
    serverDropdown.innerHTML = '<option value="">Select Server</option>' +
      servers.map((server, index) => 
        `<option value="${index}">${server.name}</option>`
      ).join('');
    console.log('‚úÖ Server dropdown populated with', servers.length, 'servers');
  }

  const details = await fetchDetails(type, id);
  console.log('üìä Fetched details:', details ? 'Success' : 'Failed');
  
  if (details) {
    // Fetch IMDB ID from external_ids if not present
    if (!details.imdb_id) {
      try {
        console.log('üîç Fetching external IDs...');
        const externalIds = await fetchFromTMDB(`${type}/${id}/external_ids`);
        if (externalIds && externalIds.imdb_id) {
          currentPlayerState.imdbId = externalIds.imdb_id;
          console.log('‚úÖ IMDB ID from external:', externalIds.imdb_id);
        }
      } catch (error) {
        console.error('Error fetching external IDs:', error);
      }
    } else {
      currentPlayerState.imdbId = details.imdb_id;
      console.log('‚úÖ IMDB ID from details:', details.imdb_id);
    }
    
    // Save to history - check if function exists
    if (typeof saveToHistory === 'function') {
      try {
        saveToHistory({ 
          id, 
          type, 
          title: details.title || details.name, 
          poster_path: details.poster_path 
        });
        console.log('‚úÖ Saved to history');
      } catch (error) {
        console.error('‚ùå Error saving to history:', error);
      }
    } else {
      console.warn('‚ö†Ô∏è saveToHistory function not available');
    }
  }

  // Load OnexBed server initially (index 0)
  console.log('‚ñ∂Ô∏è Loading server 0 (OnexBed)...');
  loadServer(0);

  // Load download servers
  console.log('‚¨áÔ∏è Updating download servers...');
  updateDownloadServers(id, currentPlayerState.imdbId, season, episode, type === 'tv');

  // Load TV season details
  if (type === 'tv' && seasonDetailsContainer) {
    console.log('üì∫ Loading TV season details...');
    seasonDetailsContainer.style.display = 'block';
    await loadTVSeasonDetails(id, season, episode);
  } else if (seasonDetailsContainer) {
    seasonDetailsContainer.style.display = 'none';
  }

  // Load popular movies section
  if (popularMoviesContainer) {
    console.log('üé¨ Loading popular movies...');
    const popularSection = document.querySelector('.popular-movies-section');
    if (popularSection) popularSection.style.display = 'block';
    popularMoviesContainer.innerHTML = '';
    await loadPopularMovies();
    setTimeout(initPopularMoviesInfiniteScroll, 500);
  }
  
  console.log('‚úÖ Player page loaded successfully');
}

/**
 * Load specific server
 */
function loadServer(serverIndex) {
  const server = servers[serverIndex];
  if (!server) return;

  const { type, id, season, episode, imdbId } = currentPlayerState;
  
  const url = buildStreamUrl(server, id, imdbId, season, episode, type === 'tv');
  setPlayerSrc(url);

  const serverDropdown = document.getElementById('server-dropdown');
  if (serverDropdown) {
    serverDropdown.value = serverIndex;
  }
}

/**
 * Load TV season details
 */
async function loadTVSeasonDetails(tvId, seasonNumber, activeEpisode) {
  const seasonDetailsContainer = document.querySelector('.tv-season-details');
  if (!seasonDetailsContainer) {
    console.error('‚ùå Season details container not found');
    return;
  }
  
  console.log('üì∫ Loading TV season details for TV ID:', tvId, 'Season:', seasonNumber);

  const tvData = await fetchDetails('tv', tvId);
  if (!tvData) {
    console.error('‚ùå Failed to fetch TV details');
    seasonDetailsContainer.innerHTML = '<p style="padding: 1rem; color: var(--text-secondary); text-align: center;">Failed to load TV show details</p>';
    return;
  }
  
  console.log('‚úÖ TV data fetched, seasons:', tvData.seasons?.length);

  seasonDetailsContainer.innerHTML = `
    <div class="section-header">
      <h2>üì∫ Seasons & Episodes</h2>
    </div>
  ` + tvData.seasons
    .filter(s => s.season_number > 0)
    .map(s => `
      <div class="season-item">
        <div class="season-header" data-season-number="${s.season_number}" data-tv-id="${tvId}">
          <span>${s.name} (${s.episode_count} Episodes)</span>
          <span>‚ñº</span>
        </div>
        <div class="episodes-grid" id="season-${s.season_number}-episodes"></div>
      </div>
    `).join('');
  
  console.log('‚úÖ Season headers created');

  const currentSeasonHeader = seasonDetailsContainer.querySelector(`[data-season-number="${seasonNumber}"]`);
  if (currentSeasonHeader) {
    currentSeasonHeader.classList.add('active');
    const episodesGrid = currentSeasonHeader.nextElementSibling;
    if (episodesGrid) {
      episodesGrid.style.display = 'grid';
      console.log('üì∫ Loading episodes for season', seasonNumber);
      await toggleSeasonEpisodes(tvId, seasonNumber, episodesGrid, activeEpisode);
    }
  }
  
  console.log('‚úÖ TV season details loaded successfully');
}

/**
 * Toggle season episodes with hide/unhide
 */
async function toggleSeasonEpisodes(tvId, seasonNumber, container, activeEpisode) {
  if (!container) return;

  if (container.classList.contains('loaded')) {
    if (container.style.display === 'grid') {
      container.style.display = 'none';
    } else {
      container.style.display = 'grid';
    }
    return;
  }

  container.innerHTML = '<div class="loader" style="display:block; position:relative; margin: 2rem auto;"></div>';
  container.style.display = 'grid';

  try {
    const seasonData = await fetchTvSeasonDetails(tvId, seasonNumber);
    if (seasonData?.episodes) {
      container.innerHTML = seasonData.episodes.map(ep => `
        <a href="#play/tv/${tvId}/${seasonNumber}/${ep.episode_number}" class="episode-item ${ep.episode_number == activeEpisode ? 'active' : ''}">
          <img src="${getImageUrl(ep.still_path, 'w342')}" class="episode-thumbnail" alt="${ep.name}" loading="lazy">
          <div class="episode-info">
            <h4>S${seasonNumber}:E${ep.episode_number} - ${ep.name}</h4>
            <p>${(ep.overview || '').substring(0, 100)}...</p>
          </div>
        </a>
      `).join('');
      container.classList.add('loaded');
    } else {
      container.innerHTML = '<p>Could not load episodes.</p>';
      container.classList.add('loaded');
    }
  } catch (error) {
    container.innerHTML = '<p>Error loading episodes.</p>';
    container.classList.add('loaded');
  }
}

/**
 * Load popular movies with infinite scroll
 */
async function loadPopularMovies(append = false) {
  if (popularMoviesState.isLoading || !popularMoviesState.hasMore) return;
  
  popularMoviesState.isLoading = true;
  
  const popularMoviesContainer = document.getElementById('popular-movies-grid');
  if (!popularMoviesContainer) {
    console.error('Popular movies container not found');
    popularMoviesState.isLoading = false;
    return;
  }

  if (!append) {
    popularMoviesContainer.innerHTML = '<div class="loader" style="display:block; margin: 2rem auto;"></div>';
  }

  try {
    if (typeof fetchDiscover === 'undefined') {
      throw new Error('fetchDiscover function not available');
    }
    
    // Use discover API for language support
    const params = new URLSearchParams({
      page: popularMoviesState.currentPage,
      sort_by: 'popularity.desc'
    });
    
    const data = await fetchDiscover('movie', params);

    if (data?.results && data.results.length > 0) {
      if (!append) {
        popularMoviesContainer.innerHTML = '';
      }

      renderMoviesGrid(popularMoviesContainer, data.results, append);
      
      popularMoviesState.currentPage++;
      popularMoviesState.hasMore = data.page < data.total_pages;
      console.log(`Loaded ${data.results.length} popular movies`);
    } else {
      if (!append) {
        popularMoviesContainer.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--text-secondary);">No popular movies found.</p>';
      }
      popularMoviesState.hasMore = false;
    }
  } catch (error) {
    console.error('Error loading popular movies:', error);
    if (!append) {
      popularMoviesContainer.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--text-secondary);">Failed to load popular movies.</p>';
    }
  } finally {
    popularMoviesState.isLoading = false;
  }
}

/**
 * Update download servers
 */
function updateDownloadServers(tmdbId, imdbId, season, episode, isTV = false) {
  const downloadButtonsGrid = document.getElementById('download-buttons-grid');
  if (!downloadButtonsGrid) {
    console.error('‚ùå Download buttons grid element not found');
    return;
  }
  
  console.log('‚¨áÔ∏è Download grid element found, updating...');
  
  if (typeof downloadServers === 'undefined' || !downloadServers || downloadServers.length === 0) {
    console.error('‚ùå downloadServers not defined or empty');
    downloadButtonsGrid.innerHTML = '<p style="padding: 1rem; color: var(--text-secondary); text-align: center;">Download servers not available</p>';
    return;
  }
  
  console.log('üì• Found', downloadServers.length, 'download servers');
  
  try {
    downloadButtonsGrid.innerHTML = downloadServers.map(server => {
      const downloadUrl = buildDownloadUrl(server, tmdbId, imdbId, season, episode, isTV);
      console.log('üîó Building download URL for', server.name, ':', downloadUrl);
      return `
        <a href="${downloadUrl}" target="_blank" rel="noopener noreferrer" class="download-btn">
          <span class="download-btn-icon">${server.icon}</span>
          <span class="download-btn-text">${server.name}</span>
        </a>
      `;
    }).join('');
    console.log('‚úÖ Download servers updated successfully with', downloadServers.length, 'buttons');
  } catch (error) {
    console.error('‚ùå Error updating download servers:', error);
    downloadButtonsGrid.innerHTML = '<p style="padding: 1rem; color: var(--text-secondary); text-align: center;">Error loading download options</p>';
  }
}

/**
 * Render movies grid
 */
function renderMoviesGrid(container, movies, append = false) {
  if (!append) {
    container.innerHTML = '';
  }

  const fragment = document.createDocumentFragment();
  
  movies.forEach(movie => {
    if (!movie.poster_path) return;

    const movieCard = document.createElement('a');
    movieCard.className = 'content-card';
    movieCard.href = `#preview/movie/${movie.id}`;
    movieCard.innerHTML = `
      <img src="${getImageUrl(movie.poster_path, 'w342')}" alt="${movie.title}" class="card-poster" loading="lazy">
      <div class="card-info">
        <h3 class="card-title">${movie.title}</h3>
        <div class="card-meta">
          <span class="card-rating">‚≠ê ${movie.vote_average.toFixed(1)}</span>
          <span>${(movie.release_date || '').substring(0, 4)}</span>
        </div>
      </div>
    `;
    fragment.appendChild(movieCard);
  });

  container.appendChild(fragment);
}

/**
 * Initialize infinite scroll for popular movies
 */
function initPopularMoviesInfiniteScroll() {
  const popularMoviesSentinel = document.getElementById('popular-movies-sentinel');
  if (!popularMoviesSentinel) return;

  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting && !popularMoviesState.isLoading && popularMoviesState.hasMore) {
      loadPopularMovies(true);
    }
  }, { threshold: 0.1 });

  observer.observe(popularMoviesSentinel);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Server dropdown change
  document.addEventListener('change', function(e) {
    if (e.target.id === 'server-dropdown') {
      const serverIndex = e.target.value;
      if (serverIndex !== '') {
        loadServer(parseInt(serverIndex));
      }
    }
  });

  // TV Season accordion
  document.addEventListener('click', function(e) {
    const seasonHeader = e.target.closest('.season-header');
    if (seasonHeader) {
      seasonHeader.classList.toggle('active');
      const { seasonNumber, tvId } = seasonHeader.dataset;
      
      const currentUrl = window.location.hash;
      let activeEpisode = 1;
      if (currentUrl.startsWith('#play/tv/')) {
        const [, , , , , episode] = currentUrl.split('/');
        activeEpisode = parseInt(episode) || 1;
      }
      
      toggleSeasonEpisodes(tvId, seasonNumber, seasonHeader.nextElementSibling, activeEpisode);
    }

    // Episode item clicks
    const episodeItem = e.target.closest('.episode-item');
    if (episodeItem && episodeItem.href) {
      e.preventDefault();
      const href = episodeItem.getAttribute('href');
      const [, , type, id, season, episode] = href.split('/');
      
      currentPlayerState = {
        ...currentPlayerState,
        season: parseInt(season),
        episode: parseInt(episode)
      };

      const serverDropdown = document.getElementById('server-dropdown');
      const currentServerIndex = serverDropdown ? parseInt(serverDropdown.value) : 0;
      loadServer(currentServerIndex);

      window.history.pushState({}, '', href);
      
      // Update download servers with current season/episode
      updateDownloadServers(id, currentPlayerState.imdbId, season, episode, true);
      
      // Update active episode styling
      document.querySelectorAll('.episode-item').forEach(ep => ep.classList.remove('active'));
      episodeItem.classList.add('active');
    }
  });

  // Initialize infinite scroll when player page loads
  if (window.location.hash.startsWith('#play')) {
    setTimeout(initPopularMoviesInfiniteScroll, 1000);
  }
});
// servers.js - Player Server Configuration



console.log('Download servers loaded:', downloadServers.length);

/**
 * Build stream URL function
 */
function buildStreamUrl(server, tmdbId, imdbId, season, episode, isTV = false) {
  const template = isTV ? server.url_tv : server.url;
  let url = template;

  url = url.replace(/\{tmdb_id\}/g, tmdbId.toString());

  if (server.type === "imdb" && imdbId) {
    const formattedImdbId = imdbId.startsWith("tt") ? imdbId : `tt${imdbId}`;
    url = url.replace(/\{imdb_id\}/g, formattedImdbId);
  } else if (server.type === "imdb" && !imdbId) {
    url = url.replace(/\{imdb_id\}/g, "");
  }

  if (isTV) {
    url = url.replace(/\{season\}/g, season || 1);
    url = url.replace(/\{episode\}/g, episode || 1);
  }

  return url;
}

/**
 * Build download URL function
 */
function buildDownloadUrl(server, tmdbId, imdbId, season, episode, isTV = false) {
  let template = isTV && server.url_tv ? server.url_tv : server.url;
  let url = template;

  url = url.replace(/\{tmdb_id\}/g, tmdbId.toString());

  if (imdbId) {
    const formattedImdbId = imdbId.startsWith("tt") ? imdbId : `tt${imdbId}`;
    url = url.replace(/\{imdb_id\}/g, formattedImdbId);
  }

  if (isTV && server.url_tv) {
    url = url.replace(/\{season\}/g, season || 1);
    url = url.replace(/\{episode\}/g, episode || 1);
  }

  return url;
}
</script>

</body>
</html>
